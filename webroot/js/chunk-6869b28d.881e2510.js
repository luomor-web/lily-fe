(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6869b28d"],{"2b90":function(e,t,a){},"35f4":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("WaterMark",[t("Header",{attrs:{back:""}}),t("Card",{attrs:{"dis-hover":"",bordered:!1,title:"报销信息"}},[t("Form",{ref:"form",staticClass:"form",attrs:{model:e.form,rules:e.rules,"label-position":e.mlabelPostion,"label-width":e.mlabelWidth},nativeOn:{submit:function(e){e.preventDefault()}}},[t("FormField",{attrs:{prop:"community_id",title:"所属小区："}},[e._v(" "+e._s(e.community_name)+" ")]),t("FormField",{attrs:{prop:"community_id",title:"报销人："}},[e._v(" "+e._s(e.userInfo.real_name)+" ")]),t("FormField",{attrs:{prop:"range",title:"费用产生时间："}},[t("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"daterange",format:"yyyy年MM月dd",options:{disabledDate:e=>e>Date.now()},placeholder:"请选择费用产生时间"},model:{value:e.form.range,callback:function(t){e.$set(e.form,"range",t)},expression:"form.range"}})],1),t("FormField",{attrs:{prop:"reason",title:"报销原因："}},[t("Input",{attrs:{type:"textarea",rows:3,"show-word-limit":"",maxlength:128,placeholder:"请输入报销原因，如出差住宿餐饮、项目需要"},model:{value:e.form.reason,callback:function(t){e.$set(e.form,"reason",t)},expression:"form.reason"}})],1),t("FormField",{attrs:{title:"报销总金额：",prop:"total",width:"300"}},[t("Input",{attrs:{readonly:""},model:{value:e.form.total,callback:function(t){e.$set(e.form,"total",t)},expression:"form.total"}})],1)],1)],1),t("Card",{staticClass:"mt-16",attrs:{"dis-hover":"",bordered:!1,title:"报销项目"}},[t("a",{attrs:{slot:"extra"},on:{click:e.addItem},slot:"extra"},[t("Icon",{attrs:{type:"ios-add-circle-outline"}}),e._v(" 添加项目 ")],1),e._l(e.items,(function(a,r){return t("div",{key:r,staticClass:"refound-item"},[t("RefoundItem",{ref:"item",refInFor:!0,attrs:{detail:a,index:r+1},model:{value:e.items[r],callback:function(t){e.$set(e.items,r,t)},expression:"items[key]"}}),t("a",{staticClass:"remove",on:{click:function(t){return e.removeItem(r)}}},[t("Icon",{attrs:{type:"ios-trash-outline"}}),e._v(" 删除项目"+e._s(r+1)+" ")],1)],1)}))],2),t("div",{staticClass:"cw-form-actions"},[t("Button",{attrs:{type:"primary",loading:e.submiting},on:{click:e.submit}},[e._v(" 提交申请 ")])],1)],1)},o=[],s=a("4b1c"),n=a("6339"),i=a("545e"),m=a("e7c9"),l=a("88bd"),d=a("3e79"),u=a("8c99"),c=(a("00e5"),a("ed70"),a("7736")),f=a("2af9"),p=a("ed08"),h=a("e49c"),g=function(){var e=this,t=e._self._c;return t("div",[t("h4",[e._v("报销项目（"+e._s(e.index)+"）信息")]),t("Form",{ref:"form",attrs:{model:e.form,"label-position":e.mlabelPostion,"label-width":e.mlabelWidth,rules:e.rules},nativeOn:{submit:function(e){e.preventDefault()}}},[t("FormField",{attrs:{title:"花销用途：",prop:"reason",width:"300"}},[t("Input",{attrs:{placeholder:"请输入花销用途"},on:{"on-change":e.trigger},model:{value:e.form.reason,callback:function(t){e.$set(e.form,"reason",t)},expression:"form.reason"}})],1),t("FormField",{attrs:{title:"发票代码：",prop:"code",width:"300"}},[t("Input",{attrs:{placeholder:"请输入发票代码"},on:{"on-change":e.trigger},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1),t("FormField",{attrs:{title:"发票号码：",prop:"num",width:"300"}},[t("Input",{attrs:{placeholder:"请输入发票号码"},on:{"on-change":e.trigger},model:{value:e.form.num,callback:function(t){e.$set(e.form,"num",t)},expression:"form.num"}})],1),t("FormField",{attrs:{title:"开票日期：",prop:"date",width:"300"}},[t("DatePicker",{attrs:{options:{disabledDate:e=>e>Date.now()},placeholder:"请输入开票日期"},on:{"on-change":e.trigger},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1),t("FormField",{attrs:{title:"电子发票：",prop:"attachment_url"}},[t("ImageUpload",{attrs:{dir:"refound"},on:{"on-change":e.trigger},model:{value:e.form.attachment_url,callback:function(t){e.$set(e.form,"attachment_url",t)},expression:"form.attachment_url"}})],1),t("FormField",{attrs:{title:"报销金额：",prop:"fee",width:"200"}},[t("Input",{attrs:{placeholder:"请输入报销金额",type:"number"},on:{"on-change":e.trigger},model:{value:e.form.fee,callback:function(t){e.$set(e.form,"fee",t)},expression:"form.fee"}})],1)],1)],1)},b=[],_={name:"OaRefoundItem",props:{value:{type:Object,default:()=>({})},index:Number},data(){return{form:{reason:"",code:"",num:"",date:"",attachment_url:"",fee:""},rules:{reason:[{required:!0,message:"请输入花销用途"},{max:56,message:"花销用途不能超过56个字"}],code:[{required:!0,message:"请输入发票代码"},{max:56,message:"发票代码不能超过56个字"}],num:[{required:!0,message:"请输入发票号码"},{max:56,message:"发票号码不能超过56个字"}],date:[{required:!0,type:"date",message:"请选择开票日期"}],attachment_url:[{required:!0,max:128,message:"请上传电子发票"}],fee:[{message:"请输入报销金额",required:!0},{message:"请输入正确的金额",pattern:/^\d+(\.\d+)?$/}]}}},mixins:[h["a"]],methods:{validate(e){this.$refs.form.validate(e)},trigger(){this.$nextTick(()=>{this.$emit("input",{...this.form,date:+this.form.date})})}},watch:{value:{deep:!0,handler(e){this.form={reason:e.reason?e.reason:"",code:e.code?e.code:"",num:e.num?e.num:"",date:e.date?"number"===typeof e.date?new Date(e.date):e.date:"",attachment_url:e.attachment_url?e.attachment_url:"",fee:e.fee?e.fee:""}}}},components:{Form:i["a"],Input:m["a"],FormField:f["j"],ImageUpload:f["l"],DatePicker:n["a"]}},v=_,y=a("e607"),F=Object(y["a"])(v,g,b,!1,null,null,null),I=F.exports,x={name:"RefoundApply",data(){return{form:{range:[],reason:"",total:0},items:[{}],rules:{range:[{required:!0,type:"array",message:"请选择费用产生时间"},{validator:(e,t,a)=>{2===t.length&&t[0]&&t[1]?a():a(new Error("请选择费用产生时间"))},message:"请选择费用产生时间"}],reason:[{required:!0,message:"请输入报销原因"},{max:128,message:"报销原因不得超过128个字"}],total:[{required:!0,type:"number",message:"请输入报销内容"}]},submiting:!1}},mixins:[h["a"]],methods:{addItem(){this.items.push({})},removeItem(e){if(1===this.items.length)return u["a"].warning("至少要有一个报销项目");this.items.splice(e,1)},submit(){this.$refs.form.validate(e=>{Promise.all(this.items.map((e,t)=>new Promise(e=>{this.$refs.item[t].validate(t=>{e(t)})}))).then(t=>{const a=t.every(e=>0==!e);if(!e||!a)return;const r={community_id:this.postInfo.default_community_id,...this.form,items:this.items.map(e=>({...e,fee:parseFloat(e.fee,10)}))};r.begin_date=+r.range[0],r.finish_date=+r.range[1],delete r.range,this.submiting=!0,p["i"]({url:"/refound/create",data:r,method:"post"}).then(e=>{this.submiting=!1,this.$router.push("/oa/refound/detail/"+e.data.id),u["a"].success("报销申请成功")}).catch(()=>this.submiting=!1)})})}},computed:{...Object(c["c"])({postInfo:"common/postInfo",userInfo:"common/userInfo"}),community_name(){if(!this.postInfo.default_community_id)return"";const e=this.postInfo.community_list.findIndex(e=>e.community_id===this.postInfo.default_community_id);return this.postInfo.community_list[e].name}},watch:{items:{deep:!0,handler(e){let t=0;e.forEach(({fee:e})=>{e&&(t+=parseFloat(e,10))}),this.form.total=t}}},components:{Header:f["k"],Card:d["a"],Button:l["a"],Input:m["a"],FormField:f["j"],Form:i["a"],DatePicker:n["a"],WaterMark:f["s"],Icon:s["a"],RefoundItem:I}},k=x,w=(a("a103"),Object(y["a"])(k,r,o,!1,null,null,null));t["default"]=w.exports},a103:function(e,t,a){"use strict";a("2b90")}}]);