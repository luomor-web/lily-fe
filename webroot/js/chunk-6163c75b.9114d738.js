(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6163c75b"],{"49ef":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t._self._c;return e("WaterMark",[e("Header",{attrs:{back:""}}),e("Card",{attrs:{"dis-hover":"",bordered:!1,title:"采购信息"}},[e("Form",{ref:"form",staticClass:"form",attrs:{model:t.form,rules:t.rules,"label-position":t.mlabelPostion,"label-width":t.mlabelWidth},nativeOn:{submit:function(t){t.preventDefault()}}},[e("FormField",{attrs:{prop:"community_id",title:"所属小区："}},[t._v(" "+t._s(t.community_name)+" ")]),e("FormField",{attrs:{prop:"community_id",title:"申请人："}},[t._v(" "+t._s(t.userInfo.real_name)+" ")]),e("FormField",{attrs:{prop:"remark",title:"采购备注："}},[e("Input",{attrs:{type:"textarea",rows:3,"show-word-limit":"",maxlength:512,placeholder:"请输入本次采购申请的备注信息，非必填"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1),e("FormField",{attrs:{title:"采购总金额：",prop:"total",width:"300"}},[e("Input",{attrs:{readonly:""},model:{value:t.form.total,callback:function(e){t.$set(t.form,"total",e)},expression:"form.total"}})],1)],1)],1),e("Card",{staticClass:"mt-16",attrs:{"dis-hover":"",bordered:!1,title:"采购项目"}},[e("a",{attrs:{slot:"extra"},on:{click:t.addItem},slot:"extra"},[e("Icon",{attrs:{type:"ios-add-circle-outline"}}),t._v(" 添加项目 ")],1),t._l(t.items,(function(i,r){return e("div",{key:r,staticClass:"purchase-item"},[e("PurchaseItem",{ref:"item",refInFor:!0,attrs:{detail:i,options:t.options,index:r+1},model:{value:t.items[r],callback:function(e){t.$set(t.items,r,e)},expression:"items[key]"}}),e("a",{staticClass:"remove",on:{click:function(e){return t.removeItem(r)}}},[e("Icon",{attrs:{type:"ios-trash-outline"}}),t._v(" 删除项目"+t._s(r+1)+" ")],1)],1)}))],2),e("div",{staticClass:"cw-form-actions"},[e("Button",{attrs:{type:"primary",loading:t.submiting},on:{click:t.submit}},[t._v(" 提交申请 ")])],1)],1)},a=[],o=i("4b1c"),s=i("6339"),l=i("545e"),n=i("e7c9"),m=i("88bd"),u=i("3e79"),d=i("8c99"),p=(i("ed70"),i("7736")),c=i("2af9"),f=i("ed08"),h=i("e49c"),_=function(){var t=this,e=t._self._c;return e("div",[e("h4",[t._v("采购项目（"+t._s(t.index)+"）信息")]),e("Form",{ref:"form",attrs:{model:t.form,"label-position":t.mlabelPostion,"label-width":t.mlabelWidth,rules:t.rules},nativeOn:{submit:function(t){t.preventDefault()}}},[e("FormField",{attrs:{title:"采购物料：",prop:"material_id",width:"300"}},[e("Select",{attrs:{placeholder:"请选择物料",filterable:""},model:{value:t.form.material_id,callback:function(e){t.$set(t.form,"material_id",e)},expression:"form.material_id"}},t._l(t.options.material,(function(i){return e("Option",{key:i.id,attrs:{value:i.id}},[t._v(" "+t._s(i.name)+" ")])})),1)],1),e("FormField",{attrs:{title:"供应商：",prop:"supplier_id",width:"300"}},[e("Select",{attrs:{placeholder:"请选择供应商",filterable:""},model:{value:t.form.supplier_id,callback:function(e){t.$set(t.form,"supplier_id",e)},expression:"form.supplier_id"}},t._l(t.options.supplier,(function(i){return e("Option",{key:i.id,attrs:{value:i.id}},[t._v(" "+t._s(i.title)+" ")])})),1)],1),e("FormField",{attrs:{title:"采购数量：",prop:"total",width:"300"}},[e("Input",{attrs:{placeholder:"请输入采购数量",type:"number"},on:{"on-change":t.trigger},model:{value:t.form.total,callback:function(e){t.$set(t.form,"total",e)},expression:"form.total"}})],1),e("FormField",{attrs:{title:"采购总金额：",prop:"fee",width:"200"}},[e("Input",{attrs:{placeholder:"请输入采购总金额",type:"number"},on:{"on-change":t.trigger},model:{value:t.form.fee,callback:function(e){t.$set(t.form,"fee",e)},expression:"form.fee"}})],1)],1)],1)},b=[],v=i("13ab"),y=i("fee1"),I={name:"OaPurchaseApply",props:{value:{type:Object,default:()=>({})},index:Number,options:Object},data(){return{form:{material_id:void 0,supplier_id:void 0,total:"",fee:""},rules:{material_id:[{required:!0,type:"number",message:"请选择所采购的物料"}],supplier_id:[{required:!0,type:"number",message:"请选择供应商信息"}],total:[{required:!0,message:"请输入采购数量"},{pattern:/^\d+$/,message:"采购数量只能为整数"}],fee:[{message:"请输入采购总金额",required:!0},{message:"请输入正确的金额",pattern:/^\d+(\.\d+)?$/}]}}},mixins:[h["a"]],methods:{validate(t){this.$refs.form.validate(t)},trigger(){this.$nextTick(()=>{this.$emit("input",{...this.form})})}},watch:{value:{deep:!0,handler(t){this.form={material_id:t.material_id?t.material_id:void 0,supplier_id:t.supplier_id?t.supplier_id:void 0,total:t.total?t.total:"",fee:t.fee?t.fee:""}}}},components:{Form:l["a"],Input:n["a"],FormField:c["j"],Select:y["a"],Option:v["a"]}},k=I,g=i("e607"),F=Object(g["a"])(k,_,b,!1,null,null,null),w=F.exports,x={name:"OaPurchaseApply",data(){return{form:{remark:"",total:0},items:[{}],rules:{remark:[{max:512,message:"采购备注不得超过512个字"}],total:[{required:!0,type:"number",message:"请输入采购内容"}]},submiting:!1,options:{material:[],supplier:[]}}},mixins:[h["a"]],mounted(){this.postInfo.default_community_id&&this.getOptions()},methods:{getOptions(){f["i"].post("/purchase/option",{community_id:this.postInfo.default_community_id}).then(t=>{this.options.material=t.data.material,this.options.supplier=t.data.supplier})},addItem(){this.items.push({})},removeItem(t){if(1===this.items.length)return d["a"].warning("至少要有一个采购项目");this.items.splice(t,1)},submit(){this.$refs.form.validate(t=>{Promise.all(this.items.map((t,e)=>new Promise(t=>{this.$refs.item[e].validate(e=>{t(e)})}))).then(e=>{const i=e.every(t=>0==!t);if(!t||!i)return;const r={community_id:this.postInfo.default_community_id,...this.form,items:this.items.map(t=>({...t,total:parseInt(t.total,10),fee:parseFloat(t.fee,10)}))};this.submiting=!0,f["i"]({url:"/purchase/create",data:r,method:"post"}).then(t=>{this.submiting=!1,this.$router.push("/oa/material/purchase/"+t.data.id),d["a"].success("采购申请成功")}).catch(()=>this.submiting=!1)})})}},computed:{...Object(p["c"])({postInfo:"common/postInfo",userInfo:"common/userInfo"}),community_name(){if(!this.postInfo.default_community_id)return"";const t=this.postInfo.community_list.findIndex(t=>t.community_id===this.postInfo.default_community_id);return this.postInfo.community_list[t].name}},watch:{"postInfo.default_community_id"(){this.getOptions()},items:{deep:!0,handler(t){let e=0;t.forEach(({fee:t})=>{t&&(e+=parseFloat(t,10))}),this.form.total=e}}},components:{Header:c["k"],Card:u["a"],Button:m["a"],Input:n["a"],FormField:c["j"],Form:l["a"],DatePicker:s["a"],WaterMark:c["s"],Icon:o["a"],PurchaseItem:w}},O=x,$=(i("a016"),Object(g["a"])(O,r,a,!1,null,null,null));e["default"]=$.exports},a016:function(t,e,i){"use strict";i("d264")},d264:function(t,e,i){}}]);