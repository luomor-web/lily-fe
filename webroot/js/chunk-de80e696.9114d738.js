(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-de80e696"],{"27b7":function(e,t,i){"use strict";var r=function(){var e=this,t=e._self._c;return t("WaterMark",{staticClass:"contract-editor"},[t("Card",{attrs:{"dis-hover":"",bordered:!1,title:"合同信息"}},[t("Form",{ref:"form",attrs:{model:e.form,"label-position":e.mlabelPostion,"label-width":e.mlabelWidth,rules:e.rules},nativeOn:{submit:function(e){e.preventDefault()}}},[t("FormField",{attrs:{title:"所在小区："}},[e._v(e._s(e.community_name)+"小区")]),t("FormField",{attrs:{title:"合同名称：",prop:"title",width:"300"}},[t("Input",{attrs:{placeholder:"请输入合同名称"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t("FormField",{attrs:{title:"甲方：",prop:"first_party",width:"300"}},[t("Input",{attrs:{placeholder:"请输入甲方称呼"},model:{value:e.form.first_party,callback:function(t){e.$set(e.form,"first_party",t)},expression:"form.first_party"}})],1),t("FormField",{attrs:{title:"甲方联系人：",prop:"first_party_linkman",width:"180"}},[t("Input",{attrs:{placeholder:"请输入甲方联系人"},model:{value:e.form.first_party_linkman,callback:function(t){e.$set(e.form,"first_party_linkman",t)},expression:"form.first_party_linkman"}})],1),t("FormField",{attrs:{title:"甲方联系电话：",prop:"first_party_phone",width:"220"}},[t("Input",{attrs:{placeholder:"请输入甲方联系电话"},model:{value:e.form.first_party_phone,callback:function(t){e.$set(e.form,"first_party_phone",t)},expression:"form.first_party_phone"}})],1),t("FormField",{attrs:{title:"乙方系业主：",prop:"is_owner"}},[t("OSwitch",{model:{value:e.form.is_owner,callback:function(t){e.$set(e.form,"is_owner",t)},expression:"form.is_owner"}},[t("span",{attrs:{slot:"open"},slot:"open"},[e._v("否")]),t("span",{attrs:{slot:"close"},slot:"close"},[e._v("是")])])],1),e.form.is_owner?e._e():t("FormField",{attrs:{title:"乙方：",prop:"second_party",width:"300"}},[t("Input",{attrs:{placeholder:"请输入乙方称呼"},model:{value:e.form.second_party,callback:function(t){e.$set(e.form,"second_party",t)},expression:"form.second_party"}})],1),e.form.is_owner?e._e():t("FormField",{attrs:{title:"乙方联系人：",prop:"second_party_linkman",width:"180"}},[t("Input",{attrs:{placeholder:"请输入乙方联系人"},model:{value:e.form.second_party_linkman,callback:function(t){e.$set(e.form,"second_party_linkman",t)},expression:"form.second_party_linkman"}})],1),e.form.is_owner?e._e():t("FormField",{attrs:{title:"乙方联系电话：",prop:"second_party_phone",width:"220"}},[t("Input",{attrs:{placeholder:"请输入乙方联系电话"},model:{value:e.form.second_party_phone,callback:function(t){e.$set(e.form,"second_party_phone",t)},expression:"form.second_party_phone"}})],1),e.form.is_owner?t("FormField",{attrs:{title:"乙方业主电话：",prop:"owner_phone",width:"300"}},[t("Input",{staticClass:"user-input",attrs:{prefix:"ios-contact",readonly:e.ownerFetching,suffix:e.ownerFetching?"ios-loading":"",placeholder:"请输入业主手机号码"},model:{value:e.form.owner_phone,callback:function(t){e.$set(e.form,"owner_phone",t)},expression:"form.owner_phone"}})],1):e._e(),e.form.is_owner?t("FormField",{attrs:{title:"乙方业主姓名：",prop:"second_party_wechat_mp_user_id",width:"300"}},[e.form.second_party_wechat_mp_user_id?t("span",[e._v(e._s(e.ownerInfo.real_name))]):t("span",[e._v("-")])]):e._e(),t("FormField",{attrs:{title:"合同类别：",prop:"category_id",width:"220"}},[t("Select",{attrs:{placeholder:"请选择合同类别"},model:{value:e.form.category_id,callback:function(t){e.$set(e.form,"category_id",t)},expression:"form.category_id"}},e._l(e.options,(function(i){return t("Option",{key:i.id,attrs:{value:i.id}},[e._v(" "+e._s(i.name)+" "),i.description?[e._v("-"+e._s(i.description))]:e._e()],2)})),1)],1),t("FormField",{attrs:{title:"合同开始时间：",prop:"begin_time"}},[t("DatePicker",{attrs:{placeholder:"请选择合同开始时间",options:{disabledDate:e=>+e<Date.now()}},model:{value:e.form.begin_time,callback:function(t){e.$set(e.form,"begin_time",t)},expression:"form.begin_time"}})],1),t("FormField",{attrs:{title:"合同结束时间：",prop:"finish_time"}},[t("DatePicker",{attrs:{placeholder:"请选择合同结束时间",options:{disabledDate:e=>+e<Date.now()}},model:{value:e.form.finish_time,callback:function(t){e.$set(e.form,"finish_time",t)},expression:"form.finish_time"}})],1),t("FormField",{attrs:{title:"合同金额：",prop:"contract_fee",width:"300"}},[t("Input",{attrs:{readonly:""},model:{value:e.form.contract_fee,callback:function(t){e.$set(e.form,"contract_fee",t)},expression:"form.contract_fee"}})],1)],1)],1),t("Card",{staticClass:"mt-16",attrs:{"dis-hover":"",bordered:!1,title:"合同项目"}},[t("a",{attrs:{slot:"extra"},on:{click:e.addItem},slot:"extra"},[t("Icon",{attrs:{type:"ios-add-circle-outline"}}),e._v(" 添加项目 ")],1),e._l(e.items,(function(i,r){return t("div",{key:r,staticClass:"item"},[t("ContractItemEditor",{ref:"item",refInFor:!0,attrs:{detail:i,index:r+1,isOwer:e.form.is_owner,options:e.ownerInfo.id?[].concat(e.ownerInfo.houses,e.ownerInfo.merchants,e.ownerInfo.carports,e.ownerInfo.garages,e.ownerInfo.warehouses):[]},model:{value:e.items[r],callback:function(t){e.$set(e.items,r,t)},expression:"items[key]"}}),t("a",{staticClass:"remove",on:{click:function(t){return e.removeItem(r)}}},[t("Icon",{attrs:{type:"ios-trash-outline"}}),e._v(" 删除项目"+e._s(r+1)+" ")],1)],1)}))],2),t("div",{staticClass:"cw-form-actions"},[t("Button",{attrs:{type:"primary",loading:e.submiting},on:{click:e.submit}},[e._v(e._s(e.update?"修改合同":"创建合同"))])],1)],1)},o=[],n=i("13ab"),a=i("fee1"),s=i("37a2"),m=i("4b1c"),l=i("6339"),d=i("e7c9"),_=i("545e"),c=i("88bd"),p=i("3e79"),f=i("8c99"),u=(i("00e5"),i("ed70"),i("7736")),h=i("2af9"),y=i("e49c"),g=i("ed08"),w=function(){var e=this,t=e._self._c;return t("div",[t("h4",[e._v("合同项目（"+e._s(e.index)+"）信息")]),t("Form",{ref:"form",attrs:{model:e.form,"label-position":e.mlabelPostion,"label-width":e.mlabelWidth,rules:e.rules},nativeOn:{submit:function(e){e.preventDefault()}}},[t("FormField",{attrs:{title:"项目名称：",prop:"title",width:"300"}},[t("Input",{attrs:{placeholder:"请输入项目名称"},on:{"on-change":e.trigger},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t("FormField",{attrs:{title:"项目备注：",prop:"descritpion"}},[t("Input",{attrs:{type:"textarea",placeholder:"请输入项目备注"},on:{"on-change":e.trigger},model:{value:e.form.descritpion,callback:function(t){e.$set(e.form,"descritpion",t)},expression:"form.descritpion"}})],1),e.isOwer?t("FormField",{attrs:{title:"项目关联房产：",prop:"building_id",width:"220"}},[t("Select",{attrs:{placeholder:"请选择关联房产"},on:{"on-change":e.trigger},model:{value:e.form.building_id,callback:function(t){e.$set(e.form,"building_id",t)},expression:"form.building_id"}},e._l(e.options,(function(i){return t("Option",{key:i.building_id,attrs:{value:i.building_id}},[e._v(" "+e._s(e._f("building")(i))+" ")])})),1)],1):e._e(),t("FormField",{attrs:{title:"项目附件：",prop:"attachment_url"}},[t("FileUpload",{attrs:{dir:"contract"},on:{"on-change":e.trigger},model:{value:e.attachment,callback:function(t){e.attachment=t},expression:"attachment"}})],1),t("FormField",{attrs:{title:"项目费用：",prop:"fee",width:"140"}},[t("Input",{attrs:{placeholder:"请输入项目费用",type:"number"},on:{"on-change":e.trigger},model:{value:e.form.fee,callback:function(t){e.$set(e.form,"fee",t)},expression:"form.fee"}})],1)],1)],1)},b=[],v={name:"ContractItemEditor",props:{value:{type:Object,default:()=>({})},options:{type:Array,default:()=>[]},index:Number,isOwer:Boolean},data(){const{value:e}=this;return{form:{id:e.id?e.id:void 0,title:e.title?e.title:"",descritpion:e.descritpion?e.descritpion:void 0,building_id:e.building_id?e.building_id:void 0,attachment_url:e.attachment_url?e.attachment_url:void 0,attachment_name:e.attachment_name?e.attachment_name:void 0,fee:e.fee?e.fee:""},attachment:{url:void 0,name:void 0},rules:{title:[{required:!0,message:"请输入项目名称"},{max:56,message:"项目名称不能超过56个字"}],descritpion:[{max:128,message:"合同名称不能超过128个字"}],building_id:[{type:"number",message:"请选择关联房产"}],fee:[{message:"请输入项目费用",required:!0},{message:"请输入正确的金额",pattern:/^\d+(\.\d+)?$/}]}}},mixins:[y["a"]],methods:{validate(e){this.$refs.form.validate(e)},trigger(){this.$nextTick(()=>{this.$emit("input",{...this.form})})}},watch:{value:{deep:!0,handler(e){this.form={id:e.id?e.id:void 0,title:e.title?e.title:"",descritpion:e.descritpion?e.descritpion:void 0,building_id:e.building_id?e.building_id:void 0,attachment_url:e.attachment_url?e.attachment_url:void 0,attachment_name:e.attachment_name?e.attachment_name:void 0,fee:e.fee?e.fee:""},this.attachment={url:e.attachment_url?e.attachment_url:void 0,name:e.attachment_name?e.attachment_name:void 0}}},attachment:{deep:!0,handler(e){this.form.attachment_url=e.url,this.form.attachment_name=e.name}}},components:{Form:_["a"],Input:d["a"],FormField:h["j"],Select:a["a"],Option:n["a"],FileUpload:h["g"]}},F=v,k=i("e607"),I=Object(k["a"])(F,w,b,!1,null,null,null),x=I.exports,$={name:"ContractEditor",props:{detail:{type:Object,default:()=>({})},update:Boolean,onSubmit:Function},data(){const{detail:e}=this;return{options:[],ownerFetching:!1,disabled:!1,ownerInfo:{},form:{title:e.title?e.title:"",category_id:e.category_id?e.category_id:void 0,first_party:e.first_party?e.first_party:"",first_party_linkman:e.first_party_linkman?e.first_party_linkman:"",first_party_phone:e.first_party_phone?e.first_party_phone:"",second_party:e.second_party?e.second_party:"",second_party_linkman:e.second_party_linkman?e.second_party_linkman:"",second_party_phone:e.second_party_phone?e.second_party_phone:"",owner_phone:e.owner_phone?e.owner_phone:"",second_party_wechat_mp_user_id:e.second_party_wechat_mp_user_id?e.second_party_wechat_mp_user_id:void 0,begin_time:e.begin_time?e.begin_time:void 0,finish_time:e.finish_time?e.finish_time:void 0,contract_fee:e.contract_fee?e.contract_fee:0,is_owner:!!e.is_owner&&e.is_owner},items:e.items?e.items:[{}],rules:{title:[{required:!0,message:"请输入合同名称"},{max:56,message:"合同名称不能超过56个字"}],first_party:[{required:!0,message:"请输入甲方称呼"},{max:56,message:"甲方称呼不能超过56个字"}],first_party_linkman:[{required:!0,message:"请输入甲方联系人"},{max:8,message:"甲方联系人不能超8个字"}],first_party_phone:[{required:!0,pattern:/^\d{11}$/,message:"请输入正确的甲方联系电话"}],second_party:[{required:!0,message:"请输入乙方称呼"},{max:56,message:"乙方称呼不能超过56个字"}],second_party_linkman:[{required:!0,message:"请输入乙方联系人"},{max:8,message:"乙方联系人不能超8个字"}],second_party_phone:[{required:!0,pattern:/^\d{11}$/,message:"请输入正确的乙方联系电话"}],owner_phone:[{required:!0,pattern:/^\d{11}$/,message:"请输入正确的业主联系电话"}],second_party_wechat_mp_user_id:[{required:!0,type:"number",message:"请输入乙方业主手机号码"}],category_id:[{required:!0,type:"number",message:"请选择合同类别"}],begin_time:[{required:!0,type:"date",message:"请选择合同开始日期"}],finish_time:[{required:!0,type:"date",message:"请选择合同结束日期"},{message:"结束日期应大于开始日期",validator:(e,t,i)=>{t&&this.form.begin_time&&+this.form.begin_time>+t?i(new Error("结束时间应大于开始时间")):i()}}],contract_fee:[{required:!0,type:"number",message:"请录入合同条目"}],is_owner:[{required:!0,type:"boolean",message:"请选择是否系业主合同"}]},submiting:!1}},mixins:[y["a"]],mounted(){this.postInfo.default_community_id&&this.getOptions()},methods:{getOptions(){g["i"].get("/contract/option").then(e=>{this.options=e.data.list})},addItem(){this.items.push({})},removeItem(e){if(1===this.items.length)return f["a"].warning("至少要有一个合同项目");this.items.splice(e,1)},submit(){this.$refs.form.validate(e=>{Promise.all(this.items.map((e,t)=>new Promise(e=>{this.$refs.item[t].validate(t=>{e(t)})}))).then(t=>{const i=t.every(e=>0==!e);if(!e||!i)return;const r={...this.form,items:this.items.map(e=>({...e,fee:parseFloat(e.fee,10)}))};r.begin_time=+r.begin_time,r.finish_time=+r.finish_time,this.submiting=!0,this.onSubmit(r).then(()=>{this.submiting=!1},()=>{this.submiting=!1})})})}},computed:{...Object(u["c"])({postInfo:"common/postInfo"}),community_name(){if(!this.postInfo.default_community_id)return"";const e=this.postInfo.community_list.findIndex(e=>e.community_id===this.postInfo.default_community_id);return this.postInfo.community_list[e].name}},watch:{detail:{deep:!0,handler(e){this.form={title:e.title?e.title:"",category_id:e.category_id?e.category_id:void 0,first_party:e.first_party?e.first_party:"",first_party_linkman:e.first_party_linkman?e.first_party_linkman:"",first_party_phone:e.first_party_phone?e.first_party_phone:"",second_party:e.second_party?e.second_party:"",second_party_linkman:e.second_party_linkman?e.second_party_linkman:"",second_party_phone:e.second_party_phone?e.second_party_phone:"",owner_phone:e.owner_phone?e.owner_phone:"",second_party_wechat_mp_user_id:e.second_party_wechat_mp_user_id?e.second_party_wechat_mp_user_id:void 0,begin_time:e.begin_time?e.begin_time:void 0,finish_time:e.finish_time?e.finish_time:void 0,contract_fee:e.contract_fee?e.contract_fee:0,is_owner:!!e.is_owner&&e.is_owner},this.items=e.items?e.items:[{}]}},"form.owner_phone"(e,t){if(/^1\d{10}$/.test(e)?(this.ownerFetching=!0,g["i"]({url:"/option/owner",data:{phone:e,community_id:this.postInfo.default_community_id},method:"post"}).then(e=>{this.ownerInfo=e.data,this.form.second_party_wechat_mp_user_id=e.data.id,this.ownerFetching=!1}).catch(()=>this.ownerFetching=!1)):this.form.second_party_wechat_mp_user_id=null,!/^1\d{10}$/.test(e)&&/^1\d{10}$/.test(t)){const e=[].concat(this.items);e.forEach((t,i)=>{e[i].building_id=void 0}),this.items=e}},"form.is_owner"(e){e||(this.ownerInfo={},this.form.owner_phone=void 0)},"postInfo.default_community_id"(){this.getOptions()},items:{deep:!0,handler(e){let t=0;e.forEach(({fee:e})=>{e&&(t+=parseFloat(e,10))}),this.form.contract_fee=t}}},components:{Card:p["a"],Button:c["a"],Form:_["a"],Input:d["a"],DatePicker:l["a"],FormField:h["j"],Icon:m["a"],OSwitch:s["a"],Select:a["a"],Option:n["a"],ContractItemEditor:x,WaterMark:h["s"]}},O=$,q=(i("97ca"),Object(k["a"])(O,r,o,!1,null,null,null));t["a"]=q.exports},"97ca":function(e,t,i){"use strict";i("ac11")},ac11:function(e,t,i){}}]);