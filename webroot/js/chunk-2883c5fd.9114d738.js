(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2883c5fd"],{"0fc7":function(t,s,e){"use strict";var r=function(){var t=this,s=t._self._c;return s("div",{class:t.wrapClasses},[s("div",{class:[t.prefixCls+"-tail"]},[s("i")]),s("div",{class:[t.prefixCls+"-head"]},[s("div",{class:[t.prefixCls+"-head-inner"]},[t.icon||t.$slots.icon||"finish"===t.currentStatus||"error"===t.currentStatus?t.$slots.icon?s("span",{staticClass:"ivu-steps-icon"},[t._t("icon")],2):s("span",{class:t.iconClasses}):s("span",[t._v(t._s(t.stepNumber))])])]),s("div",{class:[t.prefixCls+"-main"]},[s("div",{class:[t.prefixCls+"-title"]},[t._t("title",(function(){return[t._v(t._s(t.title))]}))],2),t.content||t.$slots.content?s("div",{class:[t.prefixCls+"-content"]},[t._t("content",(function(){return[t._v(t._s(t.content))]}))],2):t._e()])])},i=[],n=e("ce17"),o=e("e4a4");const a="ivu-steps",c="ivu-icon";var u={name:"Step",mixins:[n["a"]],props:{status:{validator(t){return Object(o["m"])(t,["wait","process","finish","error"])}},title:{type:String,default:""},content:{type:String},icon:{type:String}},data(){return{prefixCls:a,stepNumber:"",nextError:!1,total:1,currentStatus:""}},computed:{wrapClasses(){return[a+"-item",`${a}-status-${this.currentStatus}`,{[a+"-custom"]:!!this.icon||!!this.$slots.icon,[a+"-next-error"]:this.nextError}]},iconClasses(){let t="";return this.icon?t=this.icon:"finish"===this.currentStatus?t="ios-checkmark":"error"===this.currentStatus&&(t="ios-close"),[a+"-icon",""+c,{[`${c}-${t}`]:""!==t}]}},watch:{status(t){this.currentStatus=t,"error"===this.currentStatus&&this.$parent.setNextError()}},created(){this.currentStatus=this.status},mounted(){this.dispatch("Steps","append")},beforeDestroy(){this.dispatch("Steps","remove")}},l=u,m=e("e607"),h=Object(m["a"])(l,r,i,!1,null,null,null);s["a"]=h.exports},"101d":function(t,s,e){"use strict";var r=function(){var t=this,s=t._self._c;return s("div",{class:t.classes},[t._t("default")],2)},i=[],n=e("e4a4");const o="ivu-steps";function a(t){let s;return function(){if(s)return;s=!0;const e=this,r=arguments,i=function(){s=!1,t.apply(e,r)};this.$nextTick(i)}}var c={name:"Steps",props:{current:{type:Number,default:0},status:{validator(t){return Object(n["m"])(t,["wait","process","finish","error"])},default:"process"},size:{validator(t){return Object(n["m"])(t,["small"])}},direction:{validator(t){return Object(n["m"])(t,["horizontal","vertical"])},default:"horizontal"}},computed:{classes(){return[""+o,`${o}-${this.direction}`,{[`${o}-${this.size}`]:!!this.size}]}},methods:{updateChildProps(t){const s=this.$children.length;this.$children.forEach((e,r)=>{e.stepNumber=r+1,"horizontal"===this.direction&&(e.total=s),t&&e.currentStatus||(r===this.current?"error"!==this.status&&(e.currentStatus="process"):r<this.current?e.currentStatus="finish":e.currentStatus="wait"),"error"!==e.currentStatus&&0!==r&&(this.$children[r-1].nextError=!1)})},setNextError(){this.$children.forEach((t,s)=>{"error"===t.currentStatus&&0!==s&&(this.$children[s-1].nextError=!0)})},updateCurrent(t){if(!(this.current<0||this.current>=this.$children.length))if(t){const t=this.$children[this.current].currentStatus;t||(this.$children[this.current].currentStatus=this.status)}else this.$children[this.current].currentStatus=this.status},debouncedAppendRemove(){return a((function(){this.updateSteps()}))},updateSteps(){this.updateChildProps(!0),this.setNextError(),this.updateCurrent(!0)}},mounted(){this.updateSteps(),this.$on("append",this.debouncedAppendRemove()),this.$on("remove",this.debouncedAppendRemove())},watch:{current(){this.updateChildProps()},status(){this.updateCurrent()}}},u=c,l=e("e607"),m=Object(l["a"])(u,r,i,!1,null,null,null),h=m.exports,d=e("0fc7");h.Step=d["a"];s["a"]=h},"8ae2":function(t,s,e){"use strict";var r=e("0fc7");s["a"]=r["a"]},ff1c:function(t,s,e){"use strict";e.r(s);var r=function(){var t=this,s=t._self._c;return s("WaterMark",[s("Header",{attrs:{back:""}}),t.finish?s("Result",{attrs:{type:t.error?"error":"success",title:t.finish&&!t.error?"任务已完成":"初始化任务失败",description:t.error?t.errMsg:"今日巡检任务已完成"}},[s("div",{attrs:{slot:"actions"},slot:"actions"},[s("Button",{attrs:{type:t.error?"default":"primary"},on:{click:t.goList}},[t._v(" "+t._s(t.error?"返回任务列表":"查看未完成任务")+" ")])],1)]):s("Card",{attrs:{"dis-hover":"",bordered:!1}},[s("Steps",{attrs:{current:t.step}},t._l(t.lineInfo,(function(t){return s("Step",{key:t.id,attrs:{title:t.local}})})),1),s("Form",{ref:"form",staticClass:"form",attrs:{model:t.form,rules:t.rules,"label-position":t.mlabelPostion,"label-width":t.mlabelWidth},nativeOn:{submit:function(t){t.preventDefault()}}},[s("FormField",{attrs:{prop:"point_id",title:"巡检点："}},[t._v(" "+t._s(t.lineInfo[t.step]?t.lineInfo[t.step].local:"")+" ")]),s("FormField",{attrs:{prop:"normal",title:"是否正常："}},[s("OSwitch",{attrs:{"true-value":1,"false-value":0},model:{value:t.form.normal,callback:function(s){t.$set(t.form,"normal",s)},expression:"form.normal"}},[s("span",{attrs:{slot:"open"},slot:"open"},[t._v("否")]),s("span",{attrs:{slot:"close"},slot:"close"},[t._v("是")])])],1),s("FormField",{attrs:{prop:"remark",title:"巡检备注："}},[s("Input",{attrs:{type:"textarea",rows:3,"show-word-limit":"",maxlength:256,placeholder:"请输入巡检备注，非必须，如果巡检点有异常情况请填写"},model:{value:t.form.remark,callback:function(s){t.$set(t.form,"remark",s)},expression:"form.remark"}})],1),s("FormField",{attrs:{prop:"imgs",title:"现场图片："}},[s("MultipleImageUpload",{attrs:{max:3,dir:"mission"},model:{value:t.form.imgs,callback:function(s){t.$set(t.form,"imgs",s)},expression:"form.imgs"}})],1)],1),s("div",{staticClass:"cw-form-actions"},[s("Button",{attrs:{type:"primary",loading:t.submiting},on:{click:t.submit}},[t._v(" 提交巡检结果 ")])],1)],1),t.fetching?s("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)},i=[],n=e("8ae2"),o=e("101d"),a=e("37a2"),c=e("545e"),u=e("e7c9"),l=e("88bd"),m=e("4d77"),h=e("3e79"),d=e("8c99"),p=(e("ed70"),e("7736")),f=e("2af9"),v=e("ed08"),_=e("e49c"),g={name:"OaMissionSubmit",data(){return{fetching:!0,error:!1,errMsg:"",finish:!1,complete_id:void 0,lineInfo:[],step:0,form:{normal:1,remark:"",imgs:[]},rules:{normal:[{required:!0,message:"请选择是否存正常",type:"number"}],remark:[{max:256,message:"巡检备注不能超过256个字符"}],imgs:[{required:!0,type:"array",min:1,message:"请上传现场图片"}]},submiting:!1}},mixins:[_["a"]],mounted(){this.postInfo.default_community_id&&this.intInfo()},methods:{intInfo(){const t={id:this.$route.params.id,community_id:this.postInfo.default_community_id};v["i"].post("/mission/init",t).then(t=>{this.fetching=!1,this.complete_id=t.data.complete_id,this.lineInfo=t.data.lineInfo,t.data.point_id?this.step=this.lineInfo.findIndex(s=>s.id===t.data.point_id)+1:this.step=0}).catch(t=>{this.fetching=!1,this.finish=!0,this.error=!0,this.errMsg=t.message})},goList(){this.$router.push("/oa/mission")},submit(){this.$refs.form.validate(t=>{if(!t)return;this.submiting=!0;const s={id:this.$route.params.id,point_id:this.lineInfo[this.step].id,community_id:this.postInfo.default_community_id,complete_id:this.complete_id,normal:this.form.normal,remark:this.form.remark,img1:this.form.imgs[0],img2:this.form.imgs[1]?this.form.imgs[1]:void 0,img3:this.form.imgs[2]?this.form.imgs[2]:void 0};v["i"].post("/mission/submit",s).then(t=>{t.data.finish?this.finish=!0:(this.step++,this.form={normal:1,remark:"",imgs:[]},this.$refs.form.resetFields(),d["a"].success("提交成功")),this.submiting=!1}).catch(()=>this.submiting=!1)})}},computed:{...Object(p["c"])({postInfo:"common/postInfo"})},watch:{"postInfo.default_community_id"(){this.intInfo()}},components:{Card:h["a"],Spin:m["a"],Header:f["k"],WaterMark:f["s"],MultipleImageUpload:f["p"],Result:f["q"],Button:l["a"],Input:u["a"],Form:c["a"],FormField:f["j"],OSwitch:a["a"],Steps:o["a"],Step:n["a"]}},b=g,S=e("e607"),$=Object(S["a"])(b,r,i,!1,null,null,null);s["default"]=$.exports}}]);