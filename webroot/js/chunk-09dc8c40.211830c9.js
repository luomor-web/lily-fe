(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-09dc8c40"],{"70a0":function(e,t,s){"use strict";var a=function(){var e=this,t=e._self._c;return e.simple?t("ul",{class:e.simpleWrapClasses,style:e.styles},[t("li",{class:e.prevClasses,attrs:{title:e.t("i.page.prev")},on:{click:e.prev}},[e._m(0)]),t("div",{class:e.simplePagerClasses,attrs:{title:e.currentPage+"/"+e.allPages}},[t("input",{attrs:{type:"text",autocomplete:"off",spellcheck:"false",disabled:e.disabled},domProps:{value:e.currentPage},on:{keydown:e.keyDown,keyup:e.keyUp,change:e.keyUp}}),t("span",[e._v("/")]),e._v(" "+e._s(e.allPages)+" ")]),t("li",{class:e.nextClasses,attrs:{title:e.t("i.page.next")},on:{click:e.next}},[e._m(1)])]):t("ul",{class:e.wrapClasses,style:e.styles},[e.showTotal?t("span",{class:[e.prefixCls+"-total"]},[e._t("default",(function(){return[e._v(e._s(e.t("i.page.total"))+" "+e._s(e.total)+" "),e.total<=1?[e._v(e._s(e.t("i.page.item")))]:[e._v(e._s(e.t("i.page.items")))]]}))],2):e._e(),t("li",{class:e.prevClasses,attrs:{title:e.t("i.page.prev")},on:{click:e.prev}},[t("a",[""!==e.prevText?[e._v(e._s(e.prevText))]:t("i",{staticClass:"ivu-icon ivu-icon-ios-arrow-back"})],2)]),t("li",{class:e.firstPageClasses,attrs:{title:"1"},on:{click:function(t){return e.changePage(1)}}},[t("a",[e._v("1")])]),e.currentPage>5?t("li",{class:[e.prefixCls+"-item-jump-prev"],attrs:{title:e.t("i.page.prev5")},on:{click:e.fastPrev}},[e._m(2)]):e._e(),5===e.currentPage?t("li",{class:[e.prefixCls+"-item"],attrs:{title:e.currentPage-3},on:{click:function(t){return e.changePage(e.currentPage-3)}}},[t("a",[e._v(e._s(e.currentPage-3))])]):e._e(),e.currentPage-2>1?t("li",{class:[e.prefixCls+"-item"],attrs:{title:e.currentPage-2},on:{click:function(t){return e.changePage(e.currentPage-2)}}},[t("a",[e._v(e._s(e.currentPage-2))])]):e._e(),e.currentPage-1>1?t("li",{class:[e.prefixCls+"-item"],attrs:{title:e.currentPage-1},on:{click:function(t){return e.changePage(e.currentPage-1)}}},[t("a",[e._v(e._s(e.currentPage-1))])]):e._e(),1!=e.currentPage&&e.currentPage!=e.allPages?t("li",{class:[e.prefixCls+"-item",e.prefixCls+"-item-active"],attrs:{title:e.currentPage}},[t("a",[e._v(e._s(e.currentPage))])]):e._e(),e.currentPage+1<e.allPages?t("li",{class:[e.prefixCls+"-item"],attrs:{title:e.currentPage+1},on:{click:function(t){return e.changePage(e.currentPage+1)}}},[t("a",[e._v(e._s(e.currentPage+1))])]):e._e(),e.currentPage+2<e.allPages?t("li",{class:[e.prefixCls+"-item"],attrs:{title:e.currentPage+2},on:{click:function(t){return e.changePage(e.currentPage+2)}}},[t("a",[e._v(e._s(e.currentPage+2))])]):e._e(),e.allPages-e.currentPage===4?t("li",{class:[e.prefixCls+"-item"],attrs:{title:e.currentPage+3},on:{click:function(t){return e.changePage(e.currentPage+3)}}},[t("a",[e._v(e._s(e.currentPage+3))])]):e._e(),e.allPages-e.currentPage>=5?t("li",{class:[e.prefixCls+"-item-jump-next"],attrs:{title:e.t("i.page.next5")},on:{click:e.fastNext}},[e._m(3)]):e._e(),e.allPages>1?t("li",{class:e.lastPageClasses,attrs:{title:e.allPages},on:{click:function(t){return e.changePage(e.allPages)}}},[t("a",[e._v(e._s(e.allPages))])]):e._e(),t("li",{class:e.nextClasses,attrs:{title:e.t("i.page.next")},on:{click:e.next}},[t("a",[""!==e.nextText?[e._v(e._s(e.nextText))]:t("i",{staticClass:"ivu-icon ivu-icon-ios-arrow-forward"})],2)]),t("Options",{attrs:{"show-sizer":e.showSizer,"page-size":e.currentPageSize,"page-size-opts":e.pageSizeOpts,placement:e.placement,transfer:e.transfer,"show-elevator":e.showElevator,_current:e.currentPage,current:e.currentPage,disabled:e.disabled,"all-pages":e.allPages,"is-small":e.isSmall,eventsEnabled:e.eventsEnabled},on:{"on-size":e.onSize,"on-page":e.onPage}})],1)},i=[function(){var e=this,t=e._self._c;return t("a",[t("i",{staticClass:"ivu-icon ivu-icon-ios-arrow-back"})])},function(){var e=this,t=e._self._c;return t("a",[t("i",{staticClass:"ivu-icon ivu-icon-ios-arrow-forward"})])},function(){var e=this,t=e._self._c;return t("a",[t("i",{staticClass:"ivu-icon ivu-icon-ios-arrow-back"}),t("i",{staticClass:"ivu-icon ivu-icon-ios-more"})])},function(){var e=this,t=e._self._c;return t("a",[t("i",{staticClass:"ivu-icon ivu-icon-ios-arrow-forward"}),t("i",{staticClass:"ivu-icon ivu-icon-ios-more"})])}],r=s("e4a4"),o=function(){var e=this,t=e._self._c;return e.showSizer||e.showElevator?t("div",{class:e.optsClasses},[e.showSizer?t("div",{class:e.sizerClasses},[t("i-select",{attrs:{size:e.size,placement:e.placement,transfer:e.transfer,disabled:e.disabled,eventsEnabled:e.eventsEnabled},on:{"on-change":e.changeSize},model:{value:e.currentPageSize,callback:function(t){e.currentPageSize=t},expression:"currentPageSize"}},e._l(e.pageSizeOpts,(function(s){return t("i-option",{key:s,staticStyle:{"text-align":"center"},attrs:{value:s}},[e._v(e._s(s)+" "+e._s(e.t("i.page.page")))])})),1)],1):e._e(),e.showElevator?t("div",{class:e.ElevatorClasses},[e._v(" "+e._s(e.t("i.page.goto"))+" "),t("input",{attrs:{type:"text",autocomplete:"off",spellcheck:"false",disabled:e.disabled},domProps:{value:e._current},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.changePage.apply(null,arguments)}}}),e._v(" "+e._s(e.t("i.page.p"))+" ")]):e._e()]):e._e()},l=[],n=s("c01e"),c=s("4ff7"),u=s("e35f");const h="ivu-page";function d(e){return/^[1-9][0-9]*$/.test(e+"")}var p={name:"PageOption",mixins:[u["a"]],components:{iSelect:n["a"],iOption:c["a"]},props:{pageSizeOpts:Array,showSizer:Boolean,showElevator:Boolean,current:Number,_current:Number,pageSize:Number,allPages:Number,isSmall:Boolean,placement:String,transfer:Boolean,disabled:Boolean,eventsEnabled:Boolean},data(){return{currentPageSize:this.pageSize}},watch:{pageSize(e){this.currentPageSize=e}},computed:{size(){return this.isSmall?"small":"default"},optsClasses(){return[h+"-options"]},sizerClasses(){return[h+"-options-sizer"]},ElevatorClasses(){return[h+"-options-elevator"]}},methods:{changeSize(){this.$emit("on-size",this.currentPageSize)},changePage(e){let t=e.target.value.trim(),s=0;if(d(t)){if(t=Number(t),t!=this.current){const e=this.allPages;s=t>e?e:t}}else s=1;s&&(this.$emit("on-page",s),e.target.value=s)}}},m=p,g=s("e607"),f=Object(g["a"])(m,o,l,!1,null,null,null),_=f.exports;const b="ivu-page";var v={name:"Page",mixins:[u["a"]],components:{Options:_},props:{current:{type:Number,default:1},total:{type:Number,default:0},pageSize:{type:Number,default:10},pageSizeOpts:{type:Array,default(){return[10,20,30,40]}},placement:{validator(e){return Object(r["m"])(e,["top","bottom"])},default:"bottom"},transfer:{type:Boolean,default(){return!(!this.$IVIEW||""===this.$IVIEW.transfer)&&this.$IVIEW.transfer}},size:{validator(e){return Object(r["m"])(e,["small","default"])}},simple:{type:Boolean,default:!1},showTotal:{type:Boolean,default:!1},showElevator:{type:Boolean,default:!1},showSizer:{type:Boolean,default:!1},className:{type:String},styles:{type:Object},prevText:{type:String,default:""},nextText:{type:String,default:""},disabled:{type:Boolean,default:!1},eventsEnabled:{type:Boolean,default:!1}},data(){return{prefixCls:b,currentPage:this.current,currentPageSize:this.pageSize}},watch:{total(e){let t=Math.ceil(e/this.currentPageSize);t<this.currentPage&&(this.currentPage=0===t?1:t)},current(e){this.currentPage=e},pageSize(e){this.currentPageSize=e}},computed:{isSmall(){return"small"===this.size},allPages(){const e=Math.ceil(this.total/this.currentPageSize);return 0===e?1:e},simpleWrapClasses(){return[""+b,b+"-simple",{[""+this.className]:!!this.className}]},simplePagerClasses(){return b+"-simple-pager"},wrapClasses(){return[""+b,{[""+this.className]:!!this.className,[b+"-with-disabled"]:this.disabled,mini:"small"===this.size}]},prevClasses(){return[b+"-prev",{[b+"-disabled"]:1===this.currentPage||this.disabled,[b+"-custom-text"]:""!==this.prevText}]},nextClasses(){return[b+"-next",{[b+"-disabled"]:this.currentPage===this.allPages||this.disabled,[b+"-custom-text"]:""!==this.nextText}]},firstPageClasses(){return[b+"-item",{[b+"-item-active"]:1===this.currentPage}]},lastPageClasses(){return[b+"-item",{[b+"-item-active"]:this.currentPage===this.allPages}]}},methods:{changePage(e){this.disabled||this.currentPage!=e&&(this.currentPage=e,this.$emit("update:current",e),this.$emit("on-change",e))},prev(){if(this.disabled)return;const e=this.currentPage;if(e<=1)return!1;this.changePage(e-1),this.$emit("on-prev",e-1)},next(){if(this.disabled)return;const e=this.currentPage;if(e>=this.allPages)return!1;this.changePage(e+1),this.$emit("on-next",e+1)},fastPrev(){if(this.disabled)return;const e=this.currentPage-5;e>0?this.changePage(e):this.changePage(1)},fastNext(){if(this.disabled)return;const e=this.currentPage+5;e>this.allPages?this.changePage(this.allPages):this.changePage(e)},onSize(e){this.disabled||(this.currentPageSize=e,this.$emit("on-page-size-change",e),this.changePage(1))},onPage(e){this.disabled||this.changePage(e)},keyDown(e){const t=e.keyCode,s=t>=48&&t<=57||t>=96&&t<=105||8===t||37===t||39===t;s||e.preventDefault()},keyUp(e){const t=e.keyCode,s=parseInt(e.target.value);if(38===t)this.prev();else if(40===t)this.next();else if(13===t){let t=1;t=s>this.allPages?this.allPages:s<=0||!s?1:s,e.target.value=t,this.changePage(t)}}}},y=v,P=Object(g["a"])(y,a,i,!1,null,null,null),k=P.exports;t["a"]=k},c03a:function(e,t,s){"use strict";var a=function(){var e=this,t=e._self._c;return e.fade?t("transition",{attrs:{name:"fade"}},[t("div",{class:e.classes,style:e.wraperStyles,on:{click:function(t){return t.stopPropagation(),e.check.apply(null,arguments)}}},[e.showDot?t("span",{class:e.dotClasses,style:e.bgColorStyle}):e._e(),t("span",{class:e.textClasses,style:e.textColorStyle},[e._t("default")],2),e.closable?t("Icon",{class:e.iconClass,attrs:{color:e.lineColor,type:"ios-close"},nativeOn:{click:function(t){return t.stopPropagation(),e.close.apply(null,arguments)}}}):e._e()],1)]):t("div",{class:e.classes,style:e.wraperStyles,on:{click:function(t){return t.stopPropagation(),e.check.apply(null,arguments)}}},[e.showDot?t("span",{class:e.dotClasses,style:e.bgColorStyle}):e._e(),t("span",{class:e.textClasses,style:e.textColorStyle},[e._t("default")],2),e.closable?t("Icon",{class:e.iconClass,attrs:{color:e.lineColor,type:"ios-close"},nativeOn:{click:function(t){return t.stopPropagation(),e.close.apply(null,arguments)}}}):e._e()],1)},i=[],r=s("4b1c"),o=s("e4a4");const l="ivu-tag",n=["default","primary","success","warning","error","blue","green","red","yellow","pink","magenta","volcano","orange","gold","lime","cyan","geekblue","purple"],c=["pink","magenta","volcano","orange","gold","lime","cyan","geekblue","purple"];var u={name:"Tag",components:{Icon:r["a"]},props:{closable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},checked:{type:Boolean,default:!0},color:{type:String,default:"default"},type:{validator(e){return Object(o["m"])(e,["border","dot"])}},name:{type:[String,Number]},fade:{type:Boolean,default:!0},size:{validator(e){return Object(o["m"])(e,["default","medium","large"])},default:"default"}},data(){return{isChecked:this.checked}},computed:{classes(){return[""+l,`${l}-size-${this.size}`,{[`${l}-${this.color}`]:!!this.color&&Object(o["m"])(this.color,n),[`${l}-${this.type}`]:!!this.type,[l+"-closable"]:this.closable,[l+"-checked"]:this.isChecked}]},wraperStyles(){return Object(o["m"])(this.color,n)?{}:{background:this.isChecked?this.defaultTypeColor:"transparent",borderWidth:"1px",borderStyle:"solid",borderColor:"dot"!==this.type&&"border"!==this.type&&this.isChecked?this.borderColor:this.lineColor,color:this.lineColor}},textClasses(){return[l+"-text","border"===this.type&&Object(o["m"])(this.color,n)?`${l}-color-${this.color}`:"","dot"!==this.type&&"border"!==this.type&&"default"!==this.color&&this.isChecked&&c.indexOf(this.color)<0?l+"-color-white":""]},dotClasses(){return l+"-dot-inner"},iconClass(){return"dot"===this.type?"":"border"===this.type?Object(o["m"])(this.color,n)?`${l}-color-${this.color}`:"":void 0!==this.color?"default"===this.color?"":"rgb(255, 255, 255)":""},showDot(){return!!this.type&&"dot"===this.type},lineColor(){return"dot"===this.type?"":"border"===this.type?void 0!==this.color?Object(o["m"])(this.color,n)?"":this.color:"":void 0!==this.color?"default"===this.color?"":"rgb(255, 255, 255)":""},borderColor(){return void 0!==this.color?"default"===this.color?"":this.color:""},dotColor(){return void 0!==this.color?Object(o["m"])(this.color,n)?"":this.color:""},textColorStyle(){return Object(o["m"])(this.color,n)?{}:"dot"!==this.type&&"border"!==this.type?this.isChecked?{color:this.lineColor}:{}:{color:this.lineColor}},bgColorStyle(){return Object(o["m"])(this.color,n)?{}:{background:this.dotColor}},defaultTypeColor(){return"dot"!==this.type&&"border"!==this.type&&void 0!==this.color?Object(o["m"])(this.color,n)?"":this.color:""}},methods:{close(e){void 0===this.name?this.$emit("on-close",e):this.$emit("on-close",e,this.name)},check(){if(!this.checkable)return;const e=!this.isChecked;this.isChecked=e,void 0===this.name?this.$emit("on-change",e):this.$emit("on-change",e,this.name)}},watch:{checked(e){this.isChecked=e}}},h=u,d=s("e607"),p=Object(d["a"])(h,a,i,!1,null,null,null),m=p.exports;t["a"]=m},c6e7a:function(e,t,s){"use strict";s("ed70");var a=s("db49"),i=s("ed08");t["a"]={data(){return{page_num:1,total:0,page_size:a["c"],list:[]}},created(){this.updateFilters()},methods:{updateFilters(){if(this.page_num=this.$route.query.p?parseInt(this.$route.query.p,10):1,this.page_size=this.$route.query.s?parseInt(this.$route.query.s,10):a["c"],"object"===typeof this.filters){const e={...this.filters};for(let t in e)if(t in this.$route.query){const s=this.$route.query[t];/^\d+$/.test(s)?e[t]=parseInt(s,10):e[t]="true"===s||"false"===s?"true"===s:s}else e[t]=void 0;i["c"].vueSame(e,this.filters)||(this.filters=e)}},changeRouteQuery(){const e=["p="+this.page_num,"s="+this.page_size];if("object"===typeof this.filters)for(let t in this.filters)void 0!==this.filters[t]&&e.push(`${t}=${this.filters[t]}`);this.$router.push(`${this.$route.path}?${e.join("&")}`)},onPageChange(e){this.page_num=e,this.changeRouteQuery()},onPageSizeChange(e){this.page_num=1,this.page_size=e,this.changeRouteQuery()}},watch:{$route:{deep:!0,handler(){this.postInfo&&!this.postInfo.default_community_id||(this.updateFilters(),this.$nextTick(()=>{this.getListData()}))}}}}},dada:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("WaterMark",[t("Header"),e.userInfo.access.includes(e.ROLES.WLCC)?t("Button",{staticClass:"mb-16",attrs:{type:"primary"},on:{click:e.showModal}},[e._v(" 添加物料 ")]):e._e(),t("FilterQuery",{staticClass:"mt-16",attrs:{filterOptions:e.filterOptions,fetching:e.fetching,filters:e.filters}}),t("Card",{attrs:{"dis-hover":"",bordered:!1}},[t("Table",{attrs:{stripe:"",columns:e.columns,data:e.list}}),t("ListFooter",[t("Page",{attrs:{"show-total":"","show-elevator":"","show-sizer":"","page-size":e.page_size,total:e.total,current:e.page_num},on:{"on-change":e.onPageChange,"on-page-size-change":e.onPageSizeChange}})],1)],1),t("Modal",{attrs:{title:e.editId?"修改物料":"添加物料"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("Form",{ref:"form",attrs:{model:e.form,rules:e.rules},nativeOn:{submit:function(e){e.preventDefault()}}},[t("FormItem",{attrs:{prop:"name",label:"物料名称："}},[t("Input",{attrs:{placeholder:"请输入物料名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e.editId?e._e():t("FormItem",{attrs:{prop:"total",label:"物料数量："}},[t("Input",{attrs:{type:"number",placeholder:"请输入物料数量"},model:{value:e.form.total,callback:function(t){e.$set(e.form,"total",t)},expression:"form.total"}})],1),t("FormItem",{attrs:{prop:"category_id",label:"物料分类："}},[t("Select",{attrs:{placeholder:"请选择物料分类",filterable:""},model:{value:e.form.category_id,callback:function(t){e.$set(e.form,"category_id",t)},expression:"form.category_id"}},e._l(e.category,(function(s){return t("Option",{key:s.id,attrs:{value:s.id}},[e._v(" "+e._s(s.name)+" "),s.description?[e._v("-"+e._s(s.description))]:e._e()],2)})),1)],1),t("FormItem",{attrs:{prop:"storehouse_id",label:"所在仓库："}},[t("Select",{attrs:{placeholder:"请选择所在仓库",filterable:""},model:{value:e.form.storehouse_id,callback:function(t){e.$set(e.form,"storehouse_id",t)},expression:"form.storehouse_id"}},e._l(e.storehouse,(function(s){return t("Option",{key:s.id,attrs:{value:s.id}},[e._v(" "+e._s(s.name)+" "),s.local?[e._v("-"+e._s(s.local))]:e._e()],2)})),1)],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{on:{click:e.hideModal}},[e._v("取消")]),t("Button",{attrs:{type:"primary",loading:e.submiting},on:{click:e.submit}},[e._v(e._s(e.editId?"更新":"确认"))])],1)],1),t("MaterialUse",{attrs:{info:e.useInfo},on:{"update:info":function(t){e.useInfo=t}},model:{value:e.useVisible,callback:function(t){e.useVisible=t},expression:"useVisible"}}),t("MaterialUsed",{attrs:{info:e.showInfo},model:{value:e.usedVisible,callback:function(t){e.usedVisible=t},expression:"usedVisible"}}),t("MaterialPurchase",{attrs:{info:e.showInfo},model:{value:e.purchaseVisible,callback:function(t){e.purchaseVisible=t},expression:"purchaseVisible"}}),e.fetching?t("Spin",{attrs:{size:"large",fix:""}}):e._e()],1)},i=[],r=s("13ab"),o=s("fee1"),l=s("e7c9"),n=s("7c0d"),c=s("5ca3"),u=s("545e"),h=s("88bd"),d=s("2af6"),p=s("4d77"),m=s("70a0"),g=s("3e79"),f=s("8c99"),_=(s("ed70"),s("7736")),b=s("2af9"),v=s("ed08"),y=s("2f42"),P=s.n(y),k=s("c6e7a"),w=s("0373"),C=s.n(w),x=function(){var e=this,t=e._self._c;return t("Drawer",{attrs:{value:e.value,title:`物料「${e.info.name}」领用`,transfer:"",width:"460","class-name":"cw-drawer-width-footer",closable:!1,"mask-closable":!1}},[t("Form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-position":"top"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("FormItem",{attrs:{prop:"used_by",label:"领用人："}},[t("Colleague",{model:{value:e.form.used_by,callback:function(t){e.$set(e.form,"used_by",t)},expression:"form.used_by"}})],1),t("FormItem",{attrs:{prop:"total",label:"领用数量："}},[t("Input",{attrs:{type:"number",placeholder:"请输入领用数量"},model:{value:e.form.total,callback:function(t){e.$set(e.form,"total",t)},expression:"form.total"}})],1),t("FormItem",{attrs:{prop:"reason",label:"领用用途："}},[t("Input",{attrs:{type:"textarea",row:3,"show-word-limit":"",maxlength:128,placeholder:"请输入领用用途"},model:{value:e.form.reason,callback:function(t){e.$set(e.form,"reason",t)},expression:"form.reason"}})],1)],1),t("div",{staticClass:"cw-drawer-footer"},[t("Button",{on:{click:e.cancel}},[e._v("取消")]),t("Button",{attrs:{type:"primary",loading:e.submiting},on:{click:e.save}},[e._v("确定")])],1)],1)},z=[],I=s("9d21"),S=(s("00e5"),{name:"OaMaterialUse",props:{value:Boolean,info:Object},data(){return{submiting:!1,form:{used_by:void 0,total:"",reason:""},rules:{used_by:[{required:!0,type:"number",message:"请选择领用人"}],total:[{required:!0,message:"请输入领用数量"},{pattern:/^\d+$/,message:"领用数量仅支持整数"},{message:"领用数量应小于库存数量",validator:(e,t,s)=>{t&&this.info.total<t?s(new Error("领用数量应小于库存数量")):s()}}],reason:[{required:!0,message:"请输入领用用途"},{max:128,message:"领用用途最多输入128个字符"}]}}},methods:{cancel(){this.$emit("input",!1),this.form={used_by:void 0,total:"",reason:""},this.$refs.form.resetFields()},save(){this.$refs.form.validate(e=>{if(!e)return;this.submiting=!0;const t={id:this.info.id,community_id:this.postInfo.default_community_id,...this.form,total:parseInt(this.form.total,10)};v["i"].post("/material/use",t).then(()=>{this.$emit("update:info",{...this.info,total:this.info.total-t.total}),this.submiting=!1,f["a"].success("物品领用成功"),this.cancel()}).catch(()=>this.submiting=!1)})}},computed:{...Object(_["c"])({postInfo:"common/postInfo"})},components:{Drawer:I["a"],Form:u["a"],Input:l["a"],FormItem:c["a"],Colleague:b["c"],Button:h["a"]}}),$=S,O=s("e607"),j=Object(O["a"])($,x,z,!1,null,null,null),D=j.exports,M=function(){var e=this,t=e._self._c;return t("Drawer",{attrs:{value:e.value,title:`物料「${e.info.name}」领用记录`,transfer:"",width:"560"},on:{"on-close":e.cancel}},[t("Table",{attrs:{stripe:"",columns:e.columns,data:e.list}}),t("ListFooter",[t("Page",{attrs:{"show-total":"","show-elevator":"","page-size":e.page_size,total:e.total,current:e.page_num},on:{"on-change":e.onPageChange}})],1),e.fetching?t("Spin",{attrs:{size:"large",fix:""}}):e._e()],1)},W=[],B=s("db49"),F={name:"OaMaterialUsed",props:{value:Boolean,info:Object},data(){return{fetching:!0,page_num:1,page_size:B["c"],total:0,list:[],columns:[{title:"领用人",minWidth:100,render:(e,t)=>e("a",{on:{click:()=>this.$router.push("/oa/hr/colleague/detail/"+t.row.used_by)}},t.row.real_name)},{title:"领用数量",minWidth:100,key:"total"},{title:"领用用途",minWidth:160,key:"reason"},{title:"领用时间",minWidth:140,render:(e,t)=>e("span",P()(t.row.created_at).format("YYYY-MM-DD HH:mm:ss"))}]}},methods:{onPageChange(e){this.page_num=e,this.getListData()},getListData(){const{page_num:e,page_size:t}=this;this.fetching=!0,v["i"].post("/material/used",{page_num:e,page_size:t,material_id:this.info.id}).then(e=>{this.fetching=!1,this.page_num=e.data.page_num,this.page_size=e.data.page_size,this.list=e.data.list,this.total=e.data.total})},cancel(){this.$emit("input",!1)}},watch:{value(e){e&&(this.page_num=1,this.getListData())}},components:{Drawer:I["a"],Spin:p["a"],Table:d["a"],ListFooter:b["n"],Page:m["a"]}},L=F,E=Object(O["a"])(L,M,W,!1,null,null,null),T=E.exports,V=function(){var e=this,t=e._self._c;return t("Drawer",{attrs:{value:e.value,title:`物料「${e.info.name}」采购记录`,transfer:"",width:"560"},on:{"on-close":e.cancel}},[t("Table",{attrs:{stripe:"",columns:e.columns,data:e.list}}),t("ListFooter",[t("Page",{attrs:{"show-total":"","show-elevator":"","page-size":e.page_size,total:e.total,current:e.page_num},on:{"on-change":e.onPageChange}})],1),e.fetching?t("Spin",{attrs:{size:"large",fix:""}}):e._e()],1)},N=[],q=s("c03a"),U={name:"OaMaterialPurchase",props:{value:Boolean,info:Object},data(){return{fetching:!0,page_num:1,page_size:B["c"],total:0,list:[],columns:[{title:"采购人",minWidth:80,render:(e,t)=>e("a",{on:{click:()=>this.$router.push("/oa/hr/colleague/detail/"+t.row.used_by)}},t.row.real_name)},{title:"采购数量",minWidth:100,key:"total"},{title:"采购源",minWidth:110,render:(e,t)=>{let s="",a="";switch(t.row.origin){case 1:s="blue",a="初始入库";break;case 2:s="volcano",a="现金采购";break;case 3:s="gold",a="调拨";break}return e(q["a"],{props:{color:s}},a)}},{title:"采购状态",minWidth:100,render:(e,t)=>{let s="",a="";switch(t.row.finish){case 1:s="green",a="已入库";break;case 0:s="geekblue",a="采购中";break}return e(q["a"],{props:{color:s}},a)}},{title:"采购时间",minWidth:100,render:(e,t)=>e("span",P()(t.row.created_at).format("YYYY-MM-DD"))}]}},methods:{onPageChange(e){this.page_num=e,this.getListData()},getListData(){const{page_num:e,page_size:t}=this;this.fetching=!0,v["i"].post("/material/purchase",{page_num:e,page_size:t,material_id:this.info.id}).then(e=>{this.fetching=!1,this.page_num=e.data.page_num,this.page_size=e.data.page_size,this.list=e.data.list,this.total=e.data.total})},cancel(){this.$emit("input",!1)}},watch:{value(e){e&&(this.page_num=1,this.getListData())}},components:{Drawer:I["a"],Spin:p["a"],Table:d["a"],ListFooter:b["n"],Page:m["a"]}},Y=U,H=Object(O["a"])(Y,V,N,!1,null,null,null),Q=H.exports,R={name:"OaMaterialList",data(){return{ROLES:C.a,useVisible:!1,useInfo:{},usedVisible:!1,purchaseVisible:!1,showInfo:{},fetching:!0,filterOptions:[{label:"所在仓库",prop:"storehouse_id",list:[]},{label:"物料分类",prop:"category_id",list:[]}],filters:{storehouse_id:void 0,category_id:void 0},category:[],storehouse:[],columns:[{title:"物料编号",minWidth:140,render:(e,t)=>e("span",v["f"].num("ML",t.row.created_at,t.row.id))},{title:"物料名称",minWidth:140,key:"name"},{title:"库存数量",minWidth:120,key:"total"},{title:"所属分类",minWidth:120,key:"category"},{title:"所在仓库",minWidth:120,key:"storehouse"},{title:"创建时间",minWidth:120,render:(e,t)=>e("span",P()(t.row.created_at).format("YYYY-MM-DD HH:mm:ss"))},{title:"创建人",minWidth:120,render:(e,t)=>e("a",{on:{click:()=>this.$router.push("/oa/hr/colleague/detail/"+t.row.created_by)}},t.row.real_name)},{title:"操作",key:"id",minWidth:280,fixed:"right",render:(e,t)=>e("span",[this.userInfo.access.includes(C.a.WLCC)?e("a",{on:{click:()=>this.update(t.row.id,t.index)}},"修改"):null,this.userInfo.access.includes(C.a.WLCC)?e("a",{on:{click:()=>this.showUse(t.index)}},"物料领用"):null,e("a",{on:{click:()=>this.showPurchase(t.row)}},"采购记录"),e("a",{on:{click:()=>this.showUsed(t.row)}},"领用记录"),e("a",{on:{click:()=>this.printCode(t.row)}},"打印二维码")])}],visible:!1,editId:null,editIndex:-1,submiting:!1,form:{name:"",total:"",category_id:"",storehouse_id:""},rules:{name:[{required:!0,message:"请输入物料名称"},{max:56,message:"物料名称不能大于56个字符"}],total:[{required:!0,message:"请输入物料数量"},{pattern:/^\d+$/,message:"物料数量仅支持整数"}],category_id:[{required:!0,type:"number",message:"请选择物料分类"}],storehouse_id:[{required:!0,type:"number",message:"请选择所在仓库"}]}}},mounted(){this.postInfo.default_community_id&&this.getListData()},mixins:[k["a"]],methods:{getListData(){const{page_num:e,page_size:t,filters:s,postInfo:a}=this;this.fetching=!0;const i=()=>{v["i"].post("/material/list",{page_num:e,page_size:t,...s,community_id:a.default_community_id}).then(e=>{this.fetching=!1,this.page_num=e.data.page_num,this.page_size=e.data.page_size,this.list=e.data.list,this.total=e.data.total}).catch(()=>this.fetching=!1)};0===this.filterOptions[0].list.length?v["i"].post("/material/option",{community_id:a.default_community_id}).then(e=>{this.filterOptions[0].list=e.data.storehouse.map(e=>({label:e.name,value:e.id})),this.filterOptions[1].list=e.data.category.map(e=>({label:e.name,value:e.id})),this.category=e.data.category,this.storehouse=e.data.storehouse,i()}).catch(()=>this.fetching=!1):i()},showModal(){this.editId=null,this.editIndex=-1,this.visible=!0},hideModal(){this.visible=!1},update(e,t){const s=this.list[t];this.editId=e,this.editIndex=t,this.form={name:s.name,total:"",category_id:s.category_id,storehouse_id:s.storehouse_id},this.visible=!0},submit(){this.$refs.form.validate(e=>{if(!e)return;this.submiting=!0;const t=e=>{const t=this.category.findIndex(t=>t.id===e.category_id),s=this.storehouse.findIndex(t=>t.id===e.storehouse_id);return{category:this.category[t].name,storehouse:this.storehouse[s].name}},s=()=>{this.form={name:"",total:"",category_id:"",storehouse_id:""},this.$refs.form.resetFields(),this.submiting=!1,this.visible=!1};if(this.editId){const e={...this.form,id:this.editId,community_id:this.postInfo.default_community_id,total:parseInt(this.form.total,10)};delete e.total,v["i"].post("/material/update",e).then(()=>{const e=[].concat(this.list);e[this.editIndex]={...e[this.editIndex],...this.form,total:e[this.editIndex].total,...t(this.form)},this.list=e,s(),f["a"].success("修改物料成功")}).catch(()=>this.submiting=!1)}else{const e={...this.form,community_id:this.postInfo.default_community_id,total:parseInt(this.form.total,10)};v["i"].post("/material/create",e).then(a=>{this.list.unshift({id:a.data.id,...e,created_at:a.data.created_at,created_by:this.userInfo.id,real_name:this.userInfo.real_name,...t(this.form)}),s(),f["a"].success("添加物料成功")}).catch(()=>this.submiting=!1)}})},showUse(e){this.useVisible=!0,this.useInfo={...this.list[e]}},showUsed(e){this.usedVisible=!0,this.showInfo=e},showPurchase(e){this.purchaseVisible=!0,this.showInfo=e},printCode(e){this.$router.push(`/print/material?code=${v["f"].num("ML",e.created_at,e.id)}&title=${e.name}`)}},computed:{...Object(_["c"])({userInfo:"common/userInfo",postInfo:"common/postInfo"})},watch:{"postInfo.default_community_id"(){this.getListData()},useInfo:{deep:!0,handler(e){if(!e.id)return;const t=[].concat(this.list),s=t.findIndex(t=>t.id===e.id);t[s]=e,this.list=t}}},components:{Header:b["k"],ListFooter:b["n"],Card:g["a"],Page:m["a"],Spin:p["a"],Table:d["a"],Button:h["a"],Form:u["a"],FormItem:c["a"],Modal:n["a"],Input:l["a"],WaterMark:b["s"],FilterQuery:b["h"],Select:o["a"],Option:r["a"],MaterialUse:D,MaterialUsed:T,MaterialPurchase:Q}},A=R,J=Object(O["a"])(A,a,i,!1,null,null,null);t["default"]=J.exports}}]);