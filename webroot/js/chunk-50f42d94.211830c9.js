(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-50f42d94"],{"0a33":function(t,e,s){"use strict";s.r(e);var r=function(){var t=this,e=t._self._c;return e("WaterMark",{staticClass:"building-import"},[e("Header",{attrs:{back:""}}),e("Card",{attrs:{"dis-hover":"",bordered:!1}},[e("Steps",{attrs:{current:t.step}},[e("Step",{attrs:{title:"上传数据",content:"上传房产数据"}}),e("Step",{attrs:{title:"数据验证",content:"验证数据是否正确"}}),e("Step",{attrs:{title:"导入成功",content:"房产数据导入成功"}})],1),0===t.step?e("div",[e("Upload",{staticClass:"upload",attrs:{action:"/",type:"drag",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","before-upload":t.parseFile,"show-upload-list":!1}},[e("Icon",{attrs:{type:"ios-cloud-upload"}}),t.file?e("p",[t._v("已选择："+t._s(t.file.name))]):t._e(),e("p",[t._v("点击或拖拽访固定资产导入文件到此处上传，导入住宅、商户总数量受许可限制")])],1),e("a",{attrs:{href:t.ASSET_HOST+"/template/%E5%9B%BA%E5%AE%9A%E8%B5%84%E4%BA%A7%E5%AF%BC%E5%85%A5%E6%A8%A1%E6%9D%BF.xlsx",target:"_blank"}},[e("Icon",{attrs:{type:"ios-help-circle"}}),t._v(" 模板文件下载 ")],1),e("div",{staticClass:"cw-form-actions"},[e("Button",{attrs:{type:"primary",loading:t.parsing},on:{click:t.doParseFile}},[t._v("下一步")])],1)],1):t._e(),1===t.step?e("div",[e("h3",[t._v("可导入数据"+t._s(t.rightData.length)+"条")]),e("Table",{staticClass:"right-table",attrs:{data:t.rightData,height:"360",columns:t.rightColumns}}),e("h3",[t._v("不可导入数据"+t._s(t.errorData.length)+"条")]),e("Table",{staticClass:"error-table",attrs:{data:t.errorData,height:"220",columns:t.errorColumns}}),e("div",{staticClass:"cw-form-actions"},[e("Button",{on:{click:t.preStep}},[t._v("上一步")]),e("Button",{attrs:{type:"primary",loading:t.submiting},on:{click:t.submit}},[t._v("下一步")])],1)],1):t._e(),2===t.step?e("Result",{attrs:{title:"数据导入成功"}},[e("div",{attrs:{slot:"extra"},slot:"extra"},[e("p",[t._v("本次共导入"+t._s(t.rightData.length)+"条数据")])]),e("div",{attrs:{slot:"actions"},slot:"actions"},[e("Button",{on:{click:t.reImport}},[t._v("继续导入")]),e("Button",{attrs:{type:"primary"},on:{click:t.goList}},[t._v("查看房产")])],1)]):t._e()],1)],1)},i=[],n=s("2af6"),a=s("4b1c"),o=s("80f6"),c=s("8ae2"),u=s("101d"),l=s("88bd"),h=s("3e79"),p=s("7c0d"),d=s("8c99"),m=(s("ed70"),s("7736")),f=s("2af9"),_=s("ed08"),v=s("db49");const b=[{title:"详细",minWidth:180,render:(t,e)=>t("span",_["b"].text(e.row))},{title:"建筑面积",minWidth:80,key:"construction_area"},{title:"业主姓名",minWidth:80,render:(t,e)=>t("span",e.row.name?e.row.name:"-")},{title:"业主身份证",minWidth:140,render:(t,e)=>t("span",e.row.idcard?e.row.idcard:"-")},{title:"业主电话号码",minWidth:100,render:(t,e)=>t("span",e.row.phone?e.row.phone:"-")}];var g={name:"BasicBuildingImport",data(){return{ASSET_HOST:v["a"],step:0,file:null,parsing:!1,errorData:[],rightData:[],rightColumns:[].concat(b),errorColumns:[].concat(b,{title:"错误原因",minWidth:100,render:(t,e)=>t("span",e.row.error.join("，"))}),submiting:!1}},methods:{parseFile(t){return this.file=t,!1},doParseFile(){if(!this.file)return d["a"].error("请选择需要导入的数据文件");this.parsing=!0,_["i"]({url:"/building/parse",method:"post",data:{community_id:this.postInfo.default_community_id,file:this.file},uploadFile:!0}).then(t=>{this.parsing=!1,this.step++,this.errorData=t.data.errorData,this.rightData=t.data.rightData}).catch(()=>this.parsing=!1)},preStep(){this.file=null,this.step--},submit(){if(0===this.rightData.length)return d["a"].error("导入数据不能为空");p["a"].confirm({title:"请确认",content:`是否将数据导入到「${this.community_name}」小区`,onOk:()=>{this.submiting=!0;const t={community_id:this.postInfo.default_community_id,buildings:this.rightData.map(t=>{const e={...t};return delete t.error,e})};_["i"].post("/building/import",t).then(()=>{this.submiting=!1,this.step++}).catch(()=>this.submiting=!1)}})},goList(){this.$router.push("/basic/building")},reImport(){this.step=0,this.file=null}},computed:{...Object(m["c"])({postInfo:"common/postInfo"}),community_name(){if(!this.postInfo.default_community_id)return"";const t=this.postInfo.community_list.findIndex(t=>t.community_id===this.postInfo.default_community_id);return this.postInfo.community_list[t].name}},components:{Header:f["k"],Card:h["a"],Button:l["a"],Steps:u["a"],Step:c["a"],Upload:o["a"],Icon:a["a"],Table:n["a"],Result:f["q"],WaterMark:f["s"]}},S=g,C=(s("8392"),s("e607")),x=Object(C["a"])(S,r,i,!1,null,null,null);e["default"]=x.exports},"0fc7":function(t,e,s){"use strict";var r=function(){var t=this,e=t._self._c;return e("div",{class:t.wrapClasses},[e("div",{class:[t.prefixCls+"-tail"]},[e("i")]),e("div",{class:[t.prefixCls+"-head"]},[e("div",{class:[t.prefixCls+"-head-inner"]},[t.icon||t.$slots.icon||"finish"===t.currentStatus||"error"===t.currentStatus?t.$slots.icon?e("span",{staticClass:"ivu-steps-icon"},[t._t("icon")],2):e("span",{class:t.iconClasses}):e("span",[t._v(t._s(t.stepNumber))])])]),e("div",{class:[t.prefixCls+"-main"]},[e("div",{class:[t.prefixCls+"-title"]},[t._t("title",(function(){return[t._v(t._s(t.title))]}))],2),t.content||t.$slots.content?e("div",{class:[t.prefixCls+"-content"]},[t._t("content",(function(){return[t._v(t._s(t.content))]}))],2):t._e()])])},i=[],n=s("ce17"),a=s("e4a4");const o="ivu-steps",c="ivu-icon";var u={name:"Step",mixins:[n["a"]],props:{status:{validator(t){return Object(a["m"])(t,["wait","process","finish","error"])}},title:{type:String,default:""},content:{type:String},icon:{type:String}},data(){return{prefixCls:o,stepNumber:"",nextError:!1,total:1,currentStatus:""}},computed:{wrapClasses(){return[o+"-item",`${o}-status-${this.currentStatus}`,{[o+"-custom"]:!!this.icon||!!this.$slots.icon,[o+"-next-error"]:this.nextError}]},iconClasses(){let t="";return this.icon?t=this.icon:"finish"===this.currentStatus?t="ios-checkmark":"error"===this.currentStatus&&(t="ios-close"),[o+"-icon",""+c,{[`${c}-${t}`]:""!==t}]}},watch:{status(t){this.currentStatus=t,"error"===this.currentStatus&&this.$parent.setNextError()}},created(){this.currentStatus=this.status},mounted(){this.dispatch("Steps","append")},beforeDestroy(){this.dispatch("Steps","remove")}},l=u,h=s("e607"),p=Object(h["a"])(l,r,i,!1,null,null,null);e["a"]=p.exports},"101d":function(t,e,s){"use strict";var r=function(){var t=this,e=t._self._c;return e("div",{class:t.classes},[t._t("default")],2)},i=[],n=s("e4a4");const a="ivu-steps";function o(t){let e;return function(){if(e)return;e=!0;const s=this,r=arguments,i=function(){e=!1,t.apply(s,r)};this.$nextTick(i)}}var c={name:"Steps",props:{current:{type:Number,default:0},status:{validator(t){return Object(n["m"])(t,["wait","process","finish","error"])},default:"process"},size:{validator(t){return Object(n["m"])(t,["small"])}},direction:{validator(t){return Object(n["m"])(t,["horizontal","vertical"])},default:"horizontal"}},computed:{classes(){return[""+a,`${a}-${this.direction}`,{[`${a}-${this.size}`]:!!this.size}]}},methods:{updateChildProps(t){const e=this.$children.length;this.$children.forEach((s,r)=>{s.stepNumber=r+1,"horizontal"===this.direction&&(s.total=e),t&&s.currentStatus||(r===this.current?"error"!==this.status&&(s.currentStatus="process"):r<this.current?s.currentStatus="finish":s.currentStatus="wait"),"error"!==s.currentStatus&&0!==r&&(this.$children[r-1].nextError=!1)})},setNextError(){this.$children.forEach((t,e)=>{"error"===t.currentStatus&&0!==e&&(this.$children[e-1].nextError=!0)})},updateCurrent(t){if(!(this.current<0||this.current>=this.$children.length))if(t){const t=this.$children[this.current].currentStatus;t||(this.$children[this.current].currentStatus=this.status)}else this.$children[this.current].currentStatus=this.status},debouncedAppendRemove(){return o((function(){this.updateSteps()}))},updateSteps(){this.updateChildProps(!0),this.setNextError(),this.updateCurrent(!0)}},mounted(){this.updateSteps(),this.$on("append",this.debouncedAppendRemove()),this.$on("remove",this.debouncedAppendRemove())},watch:{current(){this.updateChildProps()},status(){this.updateCurrent()}}},u=c,l=s("e607"),h=Object(l["a"])(u,r,i,!1,null,null,null),p=h.exports,d=s("0fc7");p.Step=d["a"];e["a"]=p},"6b05":function(t,e,s){},8392:function(t,e,s){"use strict";s("6b05")},"8ae2":function(t,e,s){"use strict";var r=s("0fc7");e["a"]=r["a"]}}]);