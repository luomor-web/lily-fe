(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0f5d0ae1"],{2797:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("WaterMark",[e("Header",{attrs:{back:""}}),e("Card",{attrs:{"dis-hover":"",bordered:!1,title:"房产信息"}},[e("Row",{staticClass:"detail-row"},[e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("小区名称")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t.community_name))])]),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("房产详情")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t._f("building")(t.detail.info,!1)))])]),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v(" 房产类型 ")]),e("div",{staticClass:"detail-content"},[e("Tag",{attrs:{color:t.building_type.color}},[t._v(t._s(t.building_type.text))])],1)]),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("建筑面积")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t.detail.info.construction_area)+"㎡")])]),t.detail.info.step>=3?e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v(" 导入时间 ")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t._f("mom_format")(t.detail.info.finished_at)))])]):t._e()],1)],1),e("Card",{staticClass:"mt-16",attrs:{"dis-hover":"",bordered:!1,title:"初始业主信息"}},[e("span",{attrs:{slot:"extra"},slot:"extra"},[t.detail.registered?t._e():e("a",{on:{click:t.showModal}},[e("Icon",{attrs:{type:"ios-add-circle-outline"}}),t._v(" 添加 ")],1)]),t.detail.registered?e("Row",{staticClass:"detail-row"},[e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("业主姓名")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t.detail.registered.name))])]),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("身份证号")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t.detail.registered.idcard))])]),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("手机号码")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t.detail.registered.phone))])])],1):e("Empty",{attrs:{label:"暂无初始业主信息"}})],1),t.userInfo.access.includes(t.ROLES.YZDA)?e("Card",{staticClass:"mt-16",attrs:{"dis-hover":"",bordered:!1,title:"关联业主信息"}},[e("Table",{attrs:{columns:t.owners,data:t.detail.owners}})],1):t._e(),!t.userInfo.access.includes(t.ROLES.CLGL)||2!==t.detail.info.type&&5!==t.detail.info.type?t._e():e("Card",{staticClass:"mt-16",attrs:{"dis-hover":"",bordered:!1,title:"关联车辆信息"}},[e("Table",{attrs:{columns:t.cars,data:t.detail.cars}})],1),e("Modal",{attrs:{title:"更新初始业主信息"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("Form",{ref:"form",attrs:{rules:t.rules,model:t.form,"label-position":"top"},nativeOn:{submit:function(t){t.preventDefault()}}},[e("FormItem",{attrs:{prop:"name",label:"业主姓名："}},[e("Input",{attrs:{placeholder:"请输入业主姓名"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("FormItem",{attrs:{prop:"idcard",label:"身份证号码："}},[e("Input",{attrs:{placeholder:"请输入身份证号码"},model:{value:t.form.idcard,callback:function(e){t.$set(t.form,"idcard",e)},expression:"form.idcard"}})],1),e("FormItem",{attrs:{prop:"phone",label:"手机号码："}},[e("Input",{attrs:{placeholder:"请输入手机号码"},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("Button",{on:{click:t.hideModal}},[t._v("取消")]),e("Button",{attrs:{type:"primary",loading:t.submiting},on:{click:t.submit}},[t._v("更新")])],1)],1),e("Drawer",{attrs:{title:t.ownerDrawerTitle,placement:"left",width:"70"},model:{value:t.showOwerDrawer,callback:function(e){t.showOwerDrawer=e},expression:"showOwerDrawer"}},[e("Table",{attrs:{columns:t.historyColumn,data:t.ownerHistoryData}}),t.ownerFetching?e("Spin",{attrs:{size:"large",fix:""}}):t._e()],1),e("Drawer",{attrs:{title:t.carDrawerTitle,placement:"right",width:"70"},model:{value:t.showCarDrawer,callback:function(e){t.showCarDrawer=e},expression:"showCarDrawer"}},[e("Table",{attrs:{columns:t.historyColumn,data:t.carHistoryData}}),t.carFetching?e("Spin",{attrs:{size:"large",fix:""}}):t._e()],1),t.fetching?e("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)},a=[],r=s("9d21"),o=s("2af6"),l=s("4b1c"),n=s("e7c9"),c=s("88bd"),d=s("545e"),h=s("5ca3"),u=s("be5e"),p=s("9484"),m=s("4d77"),f=s("3e79"),_=s("7c0d"),b=s("8c99"),y=s("c03a"),w=(s("ed70"),s("7736")),g=s("2af9"),C=s("ed08"),v=s("0373"),k=s.n(v),x=s("e49c"),D=s("2f42"),I=s.n(D),$={name:"BasicBuildingDetail",data(){return{ROLES:k.a,fetching:!0,detail:{info:{},registered:null,owners:[],cars:[]},visible:!1,submiting:!1,form:{name:"",idcard:"",phone:""},rules:{name:[{required:!0,message:"请输入业主姓名"},{max:12,message:"业主姓名最多输入12个字"}],idcard:[{required:!0,message:"请输入身份证号码"},{pattern:/^\d{17}(x|X|\d){1}$/,message:"请输入正确的身份证号码"}],phone:[{required:!0,message:"请输入手机号码"},{pattern:/^1\d{10}$/,message:"请输入正确的手机号码"}]},owners:[{title:"业主姓名",minWidth:120,render:(t,e)=>this.userInfo.access.includes(k.a.YZDA)?t("a",{on:{click:()=>this.$router.push("/basic/owner/detail/"+e.row.user_id)}},e.row.real_name):t("span",e.row.real_name)},{title:"状态",minWidth:80,render:(t,e)=>t(y["a"],{props:{color:e.row.status?"green":"purple"}},e.row.status?"绑定中":"已解绑")},{title:"操作",minWidth:80,render:(t,e)=>t("span",[t("a",{on:{click:()=>this.buildingOperate(e.row,e.index)}},e.row.status?"解除绑定":"恢复绑定"),t("a",{on:{click:()=>this.getOwerHistory(e.row,e.index)}},"操作历史")])}],cars:[{title:"车牌号码",minWidth:120,render:(t,e)=>this.userInfo.access.includes(k.a.CLGL)?t("a",{on:{click:()=>this.$router.push("/basic/car/detail/"+e.row.id)}},e.row.car_number):t("span",e.row.car_number)},{title:"状态",minWidth:80,render:(t,e)=>t(y["a"],{props:{color:e.row.status?"green":"purple"}},e.row.status?"绑定中":"已解绑")},{title:"操作",minWidth:80,render:(t,e)=>t("span",[t("a",{on:{click:()=>this.carOperate(e.row,e.index)}},e.row.status?"解除绑定":"恢复绑定"),t("a",{on:{click:()=>this.getCarHistory(e.row,e.index)}},"操作历史")])}],showCarDrawer:!1,carDrawerTitle:"",carFetching:!1,showOwerDrawer:!1,carHistoryMap:{},carHistoryData:[],ownerDrawerTitle:"",ownerFetching:!1,ownerHistoryMap:{},ownerHistoryData:[],historyColumn:[{title:"操作类型",minWidth:100,render:(t,e)=>t("span",e.row.status?"恢复绑定":"解除绑定")},{title:"操作身份",minWidth:100,render:(t,e)=>{let s;switch(e.row.operate_by){case 1:s="自己";break;case 2:s="家人";break;case 3:s="物业";break}return t("span",s)}},{title:"操作人",minWidth:100,render:(t,e)=>3===e.row.operate_by?t("a",{on:{click:()=>{this.$router.push("/oa/hr/colleague/detail/"+e.row.property_company_user_id)}}},e.row.property_company_user_real_name):this.userInfo.access.includes(k.a.YZDA)?t("a",{on:{click:()=>{this.$router.push("/basic/owner/detail/"+e.row.ejyy_wechat_mp_user_id)}}},e.row.ejyy_wechat_mp_user_real_name):t("span",e.row.ejyy_wechat_mp_user_real_name)},{title:"操作时间",minWidth:180,render:(t,e)=>t("span",I()(e.row.created_at).format("YYYY-MM-DD HH:mm:ss"))}]}},mixins:[x["a"]],mounted(){this.postInfo.default_community_id&&this.getDetail()},methods:{getDetail(){const t={id:this.$route.params.id,community_id:this.postInfo.default_community_id};C["i"].post("/building/detail",t).then(t=>{this.fetching=!1,this.detail=t.data}).catch(()=>this.fetching=!1)},hideModal(){this.visible=!1},showModal(){this.visible=!0,this.form={name:"",idcard:"",phone:""},this.$refs.form.resetFields()},submit(){this.$refs.form.validate(t=>{if(!t)return;this.submiting=!0;const e={id:this.detail.info.id,community_id:this.postInfo.default_community_id,...this.form};C["i"].post("/building/registered",e).then(()=>{this.detail.registered=e,this.submiting=!1,this.hideModal(),b["a"].success("更新初始业主信息成功")}).catch(()=>this.submiting=!1)})},buildingOperate(t,e){_["a"].confirm({title:"请确认",content:`是否要「${t.status?"解绑":"恢复绑定"}」业主${t.real_name}与${C["b"].text(this.detail.info)}的关联吗`,onOk:()=>{const s={id:t.id,community_id:this.postInfo.default_community_id,building_id:this.detail.info.id},i=t.status?0:1,a=t.status?"/building/unbinding":"/building/binding";C["i"].post(a,s).then(t=>{const s=[].concat(this.detail.owners);s[e]={...s[e],status:i},this.detail.owners=s,e in this.ownerHistoryMap&&this.ownerHistoryMap[e].unshift({status:i,created_at:t.created_at,operate_by:3,property_company_user_id:this.userInfo.id,property_company_user_real_name:this.userInfo.real_name}),b["a"].success("操作成功")}).catch(()=>{})}})},getOwerHistory(t,e){if(this.ownerDrawerTitle=`业主${t.real_name}与${C["b"].text(this.detail.info,!1)}绑定关系操作历史`,this.showOwerDrawer=!0,e in this.ownerHistoryMap)this.ownerHistoryData=this.ownerHistoryMap[e];else{const s={id:t.id,community_id:this.postInfo.default_community_id};this.ownerFetching=!0,C["i"].post("/building/history",s).then(t=>{this.ownerFetching=!1,this.ownerHistoryMap[e]=t.data.list,this.ownerHistoryData=t.data.list}).catch(()=>this.ownerFetching=!1)}},carOperate(t,e){_["a"].confirm({title:"请确认",content:`是否要「${t.status?"解绑":"恢复绑定"}」车辆${t.car_number}与${C["b"].text(this.detail.info)}的关联吗`,onOk:()=>{const s={id:t.id,community_id:this.postInfo.default_community_id,building_id:this.detail.info.id},i=t.status?0:1,a=t.status?"/car/unbinding":"/car/binding";C["i"].post(a,s).then(t=>{const s=[].concat(this.detail.cars);s[e]={...s[e],status:i},this.detail.cars=s,e in this.carHistoryMap&&this.carHistoryMap[e].unshift({status:i,created_at:t.created_at,operate_by:3,property_company_user_id:this.userInfo.id,property_company_user_real_name:this.userInfo.real_name}),b["a"].success("操作成功")}).catch(()=>{})}})},getCarHistory(t,e){if(this.carDrawerTitle=`车辆${t.car_number}与${C["b"].text(this.detail.info,!1)}绑定关系操作历史`,this.showCarDrawer=!0,e in this.carHistoryMap)this.carHistoryData=this.carHistoryMap[e];else{const s={id:t.id,community_id:this.postInfo.default_community_id};this.carFetching=!0,C["i"].post("/car/history",s).then(t=>{this.carFetching=!1,this.carHistoryMap[e]=t.data.list,this.carHistoryData=t.data.list}).catch(()=>this.carFetching=!1)}}},computed:{...Object(w["c"])({postInfo:"common/postInfo",userInfo:"common/userInfo"}),building_type(){let t="",e="";switch(this.detail.info.type){case 1:t="住宅",e="geekblue";break;case 2:t="车位",e="purple";break;case 3:t="仓房",e="orange";break;case 4:t="商户",e="cyan";break;case 5:t="车库",e="blue";break}return{text:t,color:e}},community_name(){if(!this.postInfo.default_community_id)return"";const t=this.postInfo.community_list.findIndex(t=>t.community_id===this.postInfo.default_community_id);return this.postInfo.community_list[t].name}},watch:{"postInfo.default_community_id"(){this.getDetail()}},components:{Card:f["a"],Spin:m["a"],Header:g["k"],Row:p["a"],Col:u["a"],Tag:y["a"],FormItem:h["a"],Form:d["a"],Button:c["a"],Input:n["a"],Empty:g["f"],Modal:_["a"],Icon:l["a"],Table:o["a"],Drawer:r["a"],WaterMark:g["s"]}},O=$,H=s("e607"),M=Object(H["a"])(O,i,a,!1,null,null,null);e["default"]=M.exports},c03a:function(t,e,s){"use strict";var i=function(){var t=this,e=t._self._c;return t.fade?e("transition",{attrs:{name:"fade"}},[e("div",{class:t.classes,style:t.wraperStyles,on:{click:function(e){return e.stopPropagation(),t.check.apply(null,arguments)}}},[t.showDot?e("span",{class:t.dotClasses,style:t.bgColorStyle}):t._e(),e("span",{class:t.textClasses,style:t.textColorStyle},[t._t("default")],2),t.closable?e("Icon",{class:t.iconClass,attrs:{color:t.lineColor,type:"ios-close"},nativeOn:{click:function(e){return e.stopPropagation(),t.close.apply(null,arguments)}}}):t._e()],1)]):e("div",{class:t.classes,style:t.wraperStyles,on:{click:function(e){return e.stopPropagation(),t.check.apply(null,arguments)}}},[t.showDot?e("span",{class:t.dotClasses,style:t.bgColorStyle}):t._e(),e("span",{class:t.textClasses,style:t.textColorStyle},[t._t("default")],2),t.closable?e("Icon",{class:t.iconClass,attrs:{color:t.lineColor,type:"ios-close"},nativeOn:{click:function(e){return e.stopPropagation(),t.close.apply(null,arguments)}}}):t._e()],1)},a=[],r=s("4b1c"),o=s("e4a4");const l="ivu-tag",n=["default","primary","success","warning","error","blue","green","red","yellow","pink","magenta","volcano","orange","gold","lime","cyan","geekblue","purple"],c=["pink","magenta","volcano","orange","gold","lime","cyan","geekblue","purple"];var d={name:"Tag",components:{Icon:r["a"]},props:{closable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},checked:{type:Boolean,default:!0},color:{type:String,default:"default"},type:{validator(t){return Object(o["m"])(t,["border","dot"])}},name:{type:[String,Number]},fade:{type:Boolean,default:!0},size:{validator(t){return Object(o["m"])(t,["default","medium","large"])},default:"default"}},data(){return{isChecked:this.checked}},computed:{classes(){return[""+l,`${l}-size-${this.size}`,{[`${l}-${this.color}`]:!!this.color&&Object(o["m"])(this.color,n),[`${l}-${this.type}`]:!!this.type,[l+"-closable"]:this.closable,[l+"-checked"]:this.isChecked}]},wraperStyles(){return Object(o["m"])(this.color,n)?{}:{background:this.isChecked?this.defaultTypeColor:"transparent",borderWidth:"1px",borderStyle:"solid",borderColor:"dot"!==this.type&&"border"!==this.type&&this.isChecked?this.borderColor:this.lineColor,color:this.lineColor}},textClasses(){return[l+"-text","border"===this.type&&Object(o["m"])(this.color,n)?`${l}-color-${this.color}`:"","dot"!==this.type&&"border"!==this.type&&"default"!==this.color&&this.isChecked&&c.indexOf(this.color)<0?l+"-color-white":""]},dotClasses(){return l+"-dot-inner"},iconClass(){return"dot"===this.type?"":"border"===this.type?Object(o["m"])(this.color,n)?`${l}-color-${this.color}`:"":void 0!==this.color?"default"===this.color?"":"rgb(255, 255, 255)":""},showDot(){return!!this.type&&"dot"===this.type},lineColor(){return"dot"===this.type?"":"border"===this.type?void 0!==this.color?Object(o["m"])(this.color,n)?"":this.color:"":void 0!==this.color?"default"===this.color?"":"rgb(255, 255, 255)":""},borderColor(){return void 0!==this.color?"default"===this.color?"":this.color:""},dotColor(){return void 0!==this.color?Object(o["m"])(this.color,n)?"":this.color:""},textColorStyle(){return Object(o["m"])(this.color,n)?{}:"dot"!==this.type&&"border"!==this.type?this.isChecked?{color:this.lineColor}:{}:{color:this.lineColor}},bgColorStyle(){return Object(o["m"])(this.color,n)?{}:{background:this.dotColor}},defaultTypeColor(){return"dot"!==this.type&&"border"!==this.type&&void 0!==this.color?Object(o["m"])(this.color,n)?"":this.color:""}},methods:{close(t){void 0===this.name?this.$emit("on-close",t):this.$emit("on-close",t,this.name)},check(){if(!this.checkable)return;const t=!this.isChecked;this.isChecked=t,void 0===this.name?this.$emit("on-change",t):this.$emit("on-change",t,this.name)}},watch:{checked(t){this.isChecked=t}}},h=d,u=s("e607"),p=Object(u["a"])(h,i,a,!1,null,null,null),m=p.exports;e["a"]=m}}]);