(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22c449"],{f306:function(t,e,r){"use strict";r.r(e);var o=function(){var t=this,e=t._self._c;return e("WaterMark",[e("Header",{attrs:{back:""}}),e("Card",{attrs:{"dis-hover":"",bordered:!1}},[e("Form",{ref:"form",staticClass:"form",attrs:{model:t.form,rules:t.rules,"label-position":t.mlabelPostion,"label-width":t.mlabelWidth},nativeOn:{submit:function(t){t.preventDefault()}}},[e("FormField",{attrs:{prop:"community_id",title:"所属小区："}},[t._v(" "+t._s(t.community_name)+" ")]),e("FormField",{attrs:{prop:"user_id",title:"巡检人员："}},[e("Colleague",{model:{value:t.form.user_id,callback:function(e){t.$set(t.form,"user_id",e)},expression:"form.user_id"}})],1),e("FormField",{attrs:{prop:"category_id",title:"任务分类："}},[e("Select",{attrs:{placeholder:"请选择巡检路线分类",filterable:""},model:{value:t.form.category_id,callback:function(e){t.$set(t.form,"category_id",e)},expression:"form.category_id"}},t._l(t.options.category,(function(r){return e("Option",{key:r.id,attrs:{value:r.id}},[t._v(" "+t._s(r.name)+" "),r.description?[t._v("-"+t._s(r.description))]:t._e()],2)})),1)],1),e("FormField",{attrs:{prop:"line_id",title:"巡检路线："}},[e("Select",{attrs:{placeholder:"请选择巡检路线",filterable:""},model:{value:t.form.line_id,callback:function(e){t.$set(t.form,"line_id",e)},expression:"form.line_id"}},[t._l(t.options.line,(function(r){return[t.form.category_id===r.category_id?e("Option",{key:r.id,attrs:{value:r.id}},[t._v(" "+t._s(r.name)+" "),r.description?[t._v("-"+t._s(r.description))]:t._e()],2):t._e()]}))],2)],1),e("FormField",{attrs:{prop:"start_date",title:"任务开始日期：",width:"260"}},[e("DatePicker",{staticStyle:{width:"100%"},attrs:{format:"yyyy年MM月dd",options:{disabledDate:t=>+t<Date.now()-864e5},placeholder:"请选任务开始日期"},model:{value:t.form.start_date,callback:function(e){t.$set(t.form,"start_date",e)},expression:"form.start_date"}})],1),e("FormField",{attrs:{prop:"end_date",title:"任务结束日期：",width:"260"}},[e("DatePicker",{staticStyle:{width:"100%"},attrs:{format:"yyyy年MM月dd",options:{disabledDate:e=>+e<(t.form.start_date?+t.form.start_date:Date.now())},placeholder:"请选任务结束日期"},model:{value:t.form.end_date,callback:function(e){t.$set(t.form,"end_date",e)},expression:"form.end_date"}})],1),e("FormField",{attrs:{prop:"start_hour",title:"每日上报开始时间：",width:"200",unit:"时"}},[e("Input",{attrs:{type:"number",placeholder:"请输入小时数"},model:{value:t.form.start_hour,callback:function(e){t.$set(t.form,"start_hour",e)},expression:"form.start_hour"}})],1),e("FormField",{attrs:{prop:"end_hour",title:"每日上报结束时间：",width:"200",unit:"时"}},[e("Input",{attrs:{type:"number",placeholder:"请输入小时数"},model:{value:t.form.end_hour,callback:function(e){t.$set(t.form,"end_hour",e)},expression:"form.end_hour"}})],1)],1),e("div",{staticClass:"cw-form-actions"},[e("Button",{attrs:{type:"primary",loading:t.submiting},on:{click:t.submit}},[t._v(" 分配任务 ")])],1)],1),t.fetching?e("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)},i=[],a=r("13ab"),s=r("fee1"),n=r("4d77"),d=r("6339"),m=r("545e"),l=r("e7c9"),u=r("88bd"),c=r("3e79"),_=r("8c99"),f=(r("00e5"),r("ed70"),r("7736")),p=r("2af9"),h=r("ed08"),y=r("e49c"),g=r("2f42"),b=r.n(g),v={name:"MissionDispose",data(){return{fetching:!0,form:{category_id:"",start_date:"",end_date:"",start_hour:"",end_hour:"",line_id:"",user_id:void 0},rules:{category_id:[{required:!0,type:"number",message:"请选择任务类型"}],user_id:[{required:!0,type:"number",message:"请选择巡检人员"}],line_id:[{required:!0,type:"number",message:"请选择巡检路线"}],start_date:[{required:!0,type:"date",message:"请选择任务开始日期"}],end_date:[{required:!0,type:"date",message:"请选择任务结束日期"},{validator:(t,e,r)=>{e&&this.form.start_date&&+e>+this.form.start_date?r():r(new Error("任务结束日期应大于开始日期"))},message:"任务结束日期应大于开始日期"}],start_hour:[{required:!0,message:"请输入每日上报开始时间"},{validator:(t,e,r)=>{e&&e>=0&&e<=23?r():r(new Error("每日上报开始时间错误"))},message:"每日上报开始时间错误，请输入0-23之间的整数"}],end_hour:[{required:!0,message:"请输入每日上报结束时间"},{validator:(t,e,r)=>{e&&e>=0&&e<=23?r():r(new Error("每日上报结束时间错误"))},message:"每日上报结束时间错误，请输入0-23之间的整数"},{validator:(t,e,r)=>{e&&this.form.start_hour&&parseInt(this.form.start_hour,10)<parseInt(e,10)?r():r(new Error("开始时间应小于结束时间"))},message:"开始时间应小于结束时间"}]},submiting:!1,options:{category:[],line:[]}}},mixins:[y["a"]],mounted(){this.postInfo.default_community_id&&this.getOptions()},methods:{getOptions(){h["i"].post("/mission_manage/option",{community_id:this.postInfo.default_community_id}).then(t=>{this.options=t.data,this.fetching=!1}).catch(()=>this.fetching=!1)},submit(){this.$refs.form.validate(t=>{if(!t)return;const e={community_id:this.postInfo.default_community_id,...this.form};e.start_date=b()(e.start_date).startOf("day").valueOf(),e.end_date=b()(e.end_date).endOf("day").valueOf(),e.start_hour=parseInt(e.start_hour,10),e.end_hour=parseInt(e.end_hour,10),this.submiting=!0,h["i"]({url:"/mission/create",data:e,method:"post"}).then(t=>{this.submiting=!1,this.$router.push("/oa/mission/detail/"+t.data.id),_["a"].success("任务分配成功")}).catch(()=>this.submiting=!1)})}},computed:{...Object(f["c"])({postInfo:"common/postInfo",userInfo:"common/userInfo"}),community_name(){if(!this.postInfo.default_community_id)return"";const t=this.postInfo.community_list.findIndex(t=>t.community_id===this.postInfo.default_community_id);return this.postInfo.community_list[t].name}},watch:{"postInfo.default_community_id"(){this.getOptions()}},components:{Header:p["k"],Card:c["a"],Button:u["a"],Input:l["a"],FormField:p["j"],Form:m["a"],DatePicker:d["a"],WaterMark:p["s"],Spin:n["a"],Select:s["a"],Option:a["a"],Colleague:p["c"]}},w=v,k=r("e607"),F=Object(k["a"])(w,o,i,!1,null,null,null);e["default"]=F.exports}}]);