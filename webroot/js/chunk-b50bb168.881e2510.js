(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b50bb168"],{"553a":function(t,e,a){},bb9e:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("WaterMark",[e("Header"),e("div",[e("DatePicker",{attrs:{format:"yyyy年MM月dd日",value:new Date(t.start_date),placeholder:"请选择开始时间"},on:{"on-change":t.onStartDateChange}}),e("span",{staticClass:"ml-12"},[t._v("至")]),e("DatePicker",{staticClass:"ml-12",attrs:{format:"yyyy年MM月dd日",value:new Date(t.end_date),placeholder:"请选择结束时间"},on:{"on-change":t.onEndDateChange}}),e("Button",{staticClass:"ml-12",attrs:{type:"primary"},on:{click:t.getDetail}},[t._v("查询")])],1),e("Row",{attrs:{gutter:22}},[e("Col",{attrs:{span:8}},[e("Card",{staticClass:"mt-16",attrs:{"dis-hover":"",bordered:!1,title:"收取费用"}},[e("h2",{staticClass:"total-fee"},[t._v(" "+t._s(t._f("yuan")(t.chart.type[0]))+" "),e("small",[t._v("元")])])])],1),e("Col",{attrs:{span:8}},[e("Card",{staticClass:"mt-16",attrs:{"dis-hover":"",bordered:!1,title:"年度统计"}},[e("div",{ref:"chart2",staticClass:"second-chart"})])],1),e("Col",{attrs:{span:8}},[e("Card",{staticClass:"mt-16",attrs:{"dis-hover":"",bordered:!1,title:"退费比例"}},[e("div",{ref:"chart3",staticClass:"second-chart"})])],1)],1),e("Card",{staticClass:"mt-16",attrs:{"dis-hover":"",bordered:!1,title:"缴费概况"}},[e("div",{ref:"chart1",staticClass:"pay-chart"})]),t.fetching?e("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)},r=[],i=a("be5e"),o=a("9484"),n=a("4d77"),d=a("88bd"),h=a("6339"),l=a("3e79"),c=a("8c99"),f=(a("ed70"),a("7736")),p=a("2af9"),y=a("ed08"),u=a("2f42"),m=a.n(u),C=a("a70e"),b={name:"StatisticPayment",data(){const{start_date:t,end_date:e}=this.$route.query,a=m()().subtract(1,"year");return{fetching:!0,start_date:t?parseInt(t,10):a.valueOf(),end_date:e?parseInt(e,10):m()().valueOf(),chart:{year:{},type:[0,0],line:[],axis:[]}}},mounted(){this.postInfo.default_community_id&&this.getDetail(),this.$nextTick(()=>{this.payChart=C["b"](this.$refs.chart1),this.yearChart=C["b"](this.$refs.chart2),this.typeChart=C["b"](this.$refs.chart3)}),window.addEventListener("resize",this.onResize,!1)},beforeDestroy(){window.removeEventListener("resize",this.onResize),this.payChart.dispose(),this.yearChart.dispose(),this.typeChart.dispose()},methods:{onResize(){this.payChart.resize(),this.yearChart.resize(),this.typeChart.resize()},onStartDateChange(t){this.start_date=m()(t,"YYYY年MM月DD日").startOf("day").valueOf()},onEndDateChange(t){this.end_date=m()(t,"YYYY年MM月DD日").endOf("day").valueOf()},getDetail(){const{postInfo:t,start_date:e,end_date:a}=this;if(!e||!a)return c["a"].error("请选择时间范围");if(e>=a)return c["a"].error("开始日期应大于结束日期");const s=m()(e),r=m()(a),i=r.diff(s,"month");if(0===i)return c["a"].error("日期范围应大于一个月");y["i"].post("/statistic/payment",{start_date:e,end_date:a,community_id:t.default_community_id}).then(t=>{const e=[],a=[],r=[0,0],o={};for(let n=0;n<=i;n++)e.push(s.clone().add(n,"month").format("YYYY年MM月")),a[n]=0;t.data.list.forEach(({start_year:t,end_year:e,paid_fee:i,fee:n,created_at:d})=>{const h=`${t}年至${e}年物业费`;h in o||(o[h]=0),o[h]++,r[0]+=i,r[1]+=n-i,a[m()(d).diff(s,"month")]+=y["h"].yuan(i)}),this.chart={year:o,type:r,line:a,axis:e},this.drawChart(),this.fetching=!1}).catch(()=>this.fetching=!1)},drawChart(){const{line:t,axis:e,year:a,type:s}=this.chart;this.payChart.setOption({grid:{top:"3%",left:"5%",right:"3%",bottom:"8%"},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.6)",borderWidth:0,textStyle:{color:"#fff"}},xAxis:{data:e,axisLabel:{color:"#999"},axisLine:{show:!0,lineStyle:{color:"#f5f5f5"}},axisTick:{show:!0,lineStyle:{color:"#f5f5f5"},alignWithLabel:!0},axisPointer:{show:!0,label:{show:!1}}},yAxis:{nameLocation:"center",splitNumber:5,lineStyle:{color:"#f5f5f5"},axisLabel:{color:"#999"}},series:[{type:"bar",name:"本月缴费统计",showBackground:!1,itemStyle:{color:new C["a"].LinearGradient(0,0,0,1,[{offset:0,color:"#83bff6"},{offset:.5,color:"#188df0"},{offset:1,color:"#188df0"}])},data:t}]});const r=[];for(let i in a)r.push({value:a[i],name:i});this.yearChart.setOption({tooltip:{trigger:"item"},series:[{name:"年度统计",type:"pie",radius:"50%",data:r,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),this.typeChart.setOption({tooltip:{trigger:"item"},series:[{name:"退费比例",type:"pie",radius:[10,50],center:["50%","50%"],roseType:"area",itemStyle:{borderRadius:8},data:[{name:"收取费用",value:y["h"].yuan(s[0])},{name:"退费费用",value:y["h"].yuan(s[1])}]}]})}},computed:{...Object(f["c"])({postInfo:"common/postInfo"})},watch:{"postInfo.default_community_id"(){this.getDetail()}},components:{Header:p["k"],Card:l["a"],WaterMark:p["s"],DatePicker:h["a"],Button:d["a"],Spin:n["a"],Row:o["a"],Col:i["a"]}},_=b,g=(a("ce52"),a("e607")),v=Object(g["a"])(_,s,r,!1,null,null,null);e["default"]=v.exports},ce52:function(t,e,a){"use strict";a("553a")}}]);