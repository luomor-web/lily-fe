(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-629ffc0a"],{"4d88":function(t,e,s){},5739:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t._self._c;return e("WaterMark",[e("Header",{attrs:{back:""}}),e("Card",{attrs:{"dis-hover":"",bordered:!1,title:"任务信息"}},[e("span",{attrs:{slot:"extra"},slot:"extra"},[t.detail.info.cancel||t.userInfo.id!==t.detail.info.created_by?t._e():e("a",{on:{click:t.cancel}},[e("Icon",{attrs:{type:"md-return-left"}}),t._v(" 取消任务 ")],1)]),e("Row",{staticClass:"detail-row"},[e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("任务编号")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t.num))])]),t.userInfo.id!==t.detail.info.user_id?e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("任务执行人")]),e("div",{staticClass:"detail-content"},[e("router-link",{attrs:{to:"/oa/hr/colleague/detail/"+t.detail.info.user_id}},[t._v(" "+t._s(t.detail.info.real_name)+" ")])],1)]):t._e(),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("任务开始日期")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t._f("mom_format")(t.detail.info.start_date,!1)))])]),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("任务结束日期")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t._f("mom_format")(t.detail.info.end_date,!1)))])]),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("上报开始时间")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t.start_hour))])]),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("上报结束时间")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t.end_hour))])]),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("任务分类")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t.detail.info.category))])]),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("巡检路线")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t.detail.info.line))])]),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("任务状态")]),e("div",{staticClass:"detail-content"},[e("Tag",{attrs:{color:t.status.color}},[t._v(t._s(t.status.text))])],1)]),t.detail.info.cancel?e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("任务取消时间")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t._f("mom_format")(t.detail.info.canceled_at)))])]):t._e(),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("任务创建时间")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t._f("mom_format")(t.detail.info.created_at)))])]),e("Col",{attrs:{lg:8,sm:12,xs:24}},[e("span",{staticClass:"detail-label"},[t._v("任务指派人")]),e("div",{staticClass:"detail-content"},[e("router-link",{attrs:{to:"/oa/hr/colleague/detail/"+t.detail.disposeInfo.id}},[t._v(" "+t._s(t.detail.disposeInfo.real_name)+" ")])],1)])],1)],1),e("Card",{staticClass:"mt-16",attrs:{"dis-hover":"",bordered:!1,title:"执行情况"}},[e("ul",{staticClass:"nodes"},t._l(t.nodes,(function(s,a){return e("li",{key:a,class:"status"+s.status,on:{click:function(e){return t.showComplete(s)}}},[e("div",{staticClass:"status"},[t._v(" "+t._s(t.statusText(s.status))+" ")]),e("div",{staticClass:"year"},[t._v(" "+t._s(s.year)+" ")]),e("div",{staticClass:"date"},[t._v(" "+t._s(s.date)+" ")])])})),0)]),e("Drawer",{attrs:{title:`「${t.nodeStatus.year}${t.nodeStatus.date}」巡检任务详情`,transfer:"",width:"560"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[t.nodeFetching?e("Spin",{attrs:{size:"large",fix:""}}):t._e(),t.nodeList.length>0?e("Timeline",{staticClass:"node-list"},t._l(t.nodeList,(function(s,a){return e("TimelineItem",{key:a},[e("h4",[t._v(t._s(s.local))]),e("Row",{staticClass:"detail-row"},[e("Col",{attrs:{span:24}},[e("span",{staticClass:"detail-label"},[t._v("是否正常")]),e("div",{staticClass:"detail-content"},[e("Tag",{attrs:{color:s.normal?"success":"error"}},[t._v(t._s(s.normal?"是":"否"))])],1)]),e("Col",{attrs:{span:24}},[e("span",{staticClass:"detail-label"},[t._v("巡检备注")]),e("div",{staticClass:"detail-content"},[t._v(t._s(s.remark?s.remark:"-"))])]),e("Col",{attrs:{span:24}},[e("span",{staticClass:"detail-label"},[t._v("现场图片")]),e("div",{staticClass:"detail-content"},[e("Images",{attrs:{imgs:s.imgs}})],1)]),e("Col",{attrs:{span:24}},[e("span",{staticClass:"detail-label"},[t._v("图片相似度")]),e("div",{staticClass:"detail-content"},[t._v(t._s(Math.round(s.like/s.imgs.length*100))+"%")])]),e("Col",{attrs:{span:24}},[e("span",{staticClass:"detail-label"},[t._v("巡检时间")]),e("div",{staticClass:"detail-content"},[t._v(t._s(t._f("mom_format")(s.created_at)))])])],1)],1)})),1):e("Empty",{attrs:{label:"未提交巡检记录"}})],1),t.fetching?e("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)},i=[],o=s("39e3"),l=s("e4f2"),n=s("9d21"),r=s("4b1c"),c=s("c03a"),d=s("be5e"),h=s("9484"),u=s("4d77"),m=s("3e79"),f=s("8c99"),_=s("7c0d"),p=(s("ed70"),s("7736")),C=s("2af9"),v=s("ed08"),b=s("2f42"),y=s.n(b),g={name:"OaMissionDetail",data(){return{fetching:!0,detail:{info:{},disposeInfo:{},complete:[]},visible:!1,nodeStatus:{},nodeList:[],nodeFetching:!1}},mounted(){this.postInfo.default_community_id&&this.getDetail()},methods:{getDetail(){const t={id:this.$route.params.id,community_id:this.postInfo.default_community_id};v["i"].post("/mission/detail",t).then(t=>{this.fetching=!1,this.detail=t.data}).catch(()=>this.fetching=!1)},cancel(){_["a"].confirm({title:"请确认",content:"确认要取消本次巡检任务吗？此操作不可恢复",onOk:()=>{const t={id:this.$route.params.id,community_id:this.postInfo.default_community_id};v["i"].post("/mission/cancel",t).then(t=>{this.detail.info.cancel=1,this.detail.info.canceled_at=t.data.canceled_at,f["a"].success("取消任务成功")}).catch(()=>{})}})},statusText(t){switch(t){case 1:return"任务取消";case 2:return"日期未到";case 3:return"已完成";case 4:return"巡检中";case 5:return"未完成"}},showComplete(t){if(2!==t.status){if(!t.id)return f["a"].warning("未查询到任务记录");this.nodeFetching=!0,this.nodeStatus=t,this.visible=!0,v["i"].get("/mission/line/"+t.id).then(t=>{this.nodeList=t.data.list,this.nodeFetching=!1}).catch(()=>this.nodeFetching=!1)}}},computed:{...Object(p["c"])({postInfo:"common/postInfo",userInfo:"common/userInfo"}),num(){return v["f"].num("MN",this.detail.info.created_at,this.detail.info.id)},start_hour(){return void 0===this.detail.info.start_hour?"":y()().hour(this.detail.info.start_hour).minute(0).format("HH:mm")},end_hour(){return this.detail.info.end_hour?y()().hour(this.detail.info.end_hour).minute(0).format("HH:mm"):""},status(){let t="",e="";return this.detail.info.cancel?(t="magenta",e="已取消"):this.detail.info.start_date>Date.now()?(t="default",e="未开始"):this.detail.info.end_date<Date.now()?(t="blue",e="已结束"):(t="cyan",e="进行中"),{color:t,text:e}},nodes(){if(!this.detail.info.start_date)return[];const t=[];let e=y()(this.detail.info.start_date).startOf("day");const s=y()(this.detail.info.end_date).add(1,"day"),a=y()();while(!s.isSame(e,"day")){let s;const i=this.detail.complete.findIndex(t=>t.date===e.valueOf()),o=i>=0?this.detail.complete[i]:void 0;s=this.detail.info.cancel&&this.detail.info.canceled_at<e.valueOf()?1:a.isBefore(e)?2:o&&o.finish?3:a.isSame(e,"day")&&o&&e.hour()>=this.detail.info.start_hour&&e.hour()<=this.detail.info.end_hour&&o.point_id?4:5,t.push({year:e.format("YYYY年"),date:e.format("MM月DD日"),id:o?o.id:null,status:s}),e.add(1,"day")}return t}},watch:{"postInfo.default_community_id"(){this.getDetail()}},components:{Card:m["a"],Spin:u["a"],Header:C["k"],Row:h["a"],Col:d["a"],Tag:c["a"],WaterMark:C["s"],Images:C["m"],Icon:r["a"],Drawer:n["a"],Timeline:l["a"],TimelineItem:o["a"],Empty:C["f"]}},k=g,x=(s("d145"),s("e607")),w=Object(x["a"])(k,a,i,!1,null,null,null);e["default"]=w.exports},c03a:function(t,e,s){"use strict";var a=function(){var t=this,e=t._self._c;return t.fade?e("transition",{attrs:{name:"fade"}},[e("div",{class:t.classes,style:t.wraperStyles,on:{click:function(e){return e.stopPropagation(),t.check.apply(null,arguments)}}},[t.showDot?e("span",{class:t.dotClasses,style:t.bgColorStyle}):t._e(),e("span",{class:t.textClasses,style:t.textColorStyle},[t._t("default")],2),t.closable?e("Icon",{class:t.iconClass,attrs:{color:t.lineColor,type:"ios-close"},nativeOn:{click:function(e){return e.stopPropagation(),t.close.apply(null,arguments)}}}):t._e()],1)]):e("div",{class:t.classes,style:t.wraperStyles,on:{click:function(e){return e.stopPropagation(),t.check.apply(null,arguments)}}},[t.showDot?e("span",{class:t.dotClasses,style:t.bgColorStyle}):t._e(),e("span",{class:t.textClasses,style:t.textColorStyle},[t._t("default")],2),t.closable?e("Icon",{class:t.iconClass,attrs:{color:t.lineColor,type:"ios-close"},nativeOn:{click:function(e){return e.stopPropagation(),t.close.apply(null,arguments)}}}):t._e()],1)},i=[],o=s("4b1c"),l=s("e4a4");const n="ivu-tag",r=["default","primary","success","warning","error","blue","green","red","yellow","pink","magenta","volcano","orange","gold","lime","cyan","geekblue","purple"],c=["pink","magenta","volcano","orange","gold","lime","cyan","geekblue","purple"];var d={name:"Tag",components:{Icon:o["a"]},props:{closable:{type:Boolean,default:!1},checkable:{type:Boolean,default:!1},checked:{type:Boolean,default:!0},color:{type:String,default:"default"},type:{validator(t){return Object(l["m"])(t,["border","dot"])}},name:{type:[String,Number]},fade:{type:Boolean,default:!0},size:{validator(t){return Object(l["m"])(t,["default","medium","large"])},default:"default"}},data(){return{isChecked:this.checked}},computed:{classes(){return[""+n,`${n}-size-${this.size}`,{[`${n}-${this.color}`]:!!this.color&&Object(l["m"])(this.color,r),[`${n}-${this.type}`]:!!this.type,[n+"-closable"]:this.closable,[n+"-checked"]:this.isChecked}]},wraperStyles(){return Object(l["m"])(this.color,r)?{}:{background:this.isChecked?this.defaultTypeColor:"transparent",borderWidth:"1px",borderStyle:"solid",borderColor:"dot"!==this.type&&"border"!==this.type&&this.isChecked?this.borderColor:this.lineColor,color:this.lineColor}},textClasses(){return[n+"-text","border"===this.type&&Object(l["m"])(this.color,r)?`${n}-color-${this.color}`:"","dot"!==this.type&&"border"!==this.type&&"default"!==this.color&&this.isChecked&&c.indexOf(this.color)<0?n+"-color-white":""]},dotClasses(){return n+"-dot-inner"},iconClass(){return"dot"===this.type?"":"border"===this.type?Object(l["m"])(this.color,r)?`${n}-color-${this.color}`:"":void 0!==this.color?"default"===this.color?"":"rgb(255, 255, 255)":""},showDot(){return!!this.type&&"dot"===this.type},lineColor(){return"dot"===this.type?"":"border"===this.type?void 0!==this.color?Object(l["m"])(this.color,r)?"":this.color:"":void 0!==this.color?"default"===this.color?"":"rgb(255, 255, 255)":""},borderColor(){return void 0!==this.color?"default"===this.color?"":this.color:""},dotColor(){return void 0!==this.color?Object(l["m"])(this.color,r)?"":this.color:""},textColorStyle(){return Object(l["m"])(this.color,r)?{}:"dot"!==this.type&&"border"!==this.type?this.isChecked?{color:this.lineColor}:{}:{color:this.lineColor}},bgColorStyle(){return Object(l["m"])(this.color,r)?{}:{background:this.dotColor}},defaultTypeColor(){return"dot"!==this.type&&"border"!==this.type&&void 0!==this.color?Object(l["m"])(this.color,r)?"":this.color:""}},methods:{close(t){void 0===this.name?this.$emit("on-close",t):this.$emit("on-close",t,this.name)},check(){if(!this.checkable)return;const t=!this.isChecked;this.isChecked=t,void 0===this.name?this.$emit("on-change",t):this.$emit("on-change",t,this.name)}},watch:{checked(t){this.isChecked=t}}},h=d,u=s("e607"),m=Object(u["a"])(h,a,i,!1,null,null,null),f=m.exports;e["a"]=f},d145:function(t,e,s){"use strict";s("4d88")}}]);