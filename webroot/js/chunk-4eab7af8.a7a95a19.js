(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4eab7af8"],{"2e33":function(t,a,i){"use strict";i("448e")},"448e":function(t,a,i){},"8cc7":function(t,a,i){"use strict";i.r(a);var e=function(){var t=this,a=t._self._c;return a("section",[a("Header",[a("span",{attrs:{slot:"description"},slot:"description"},[t._v(" 小区独立设置，当前小区是"+t._s(t.community_name)+"，切换小区请点击右上角，请谨慎操作，如有疑问请发信至 "),a("a",{attrs:{href:"mailto:contact@luomor.com"}},[t._v("技术支持")]),t._v(" 咨询。 ")])]),a("section",[a("Form",{ref:"form",staticClass:"form-inline",attrs:{"label-position":"right","label-width":100,model:t.form,rules:t.rules},nativeOn:{submit:function(t){t.preventDefault()}}},[a("Row",{attrs:{gutter:18}},[a("Col",{attrs:{span:8}},[a("FormItem",{attrs:{prop:"lng",label:"经度："}},[a("Input",{attrs:{placeholder:"请在地图上标记",readonly:""},model:{value:t.form.lng,callback:function(a){t.$set(t.form,"lng",a)},expression:"form.lng"}})],1)],1),a("Col",{attrs:{span:8}},[a("FormItem",{attrs:{prop:"lat",label:"纬度："}},[a("Input",{attrs:{placeholder:"请在地图上标记",readonly:""},model:{value:t.form.lat,callback:function(a){t.$set(t.form,"lat",a)},expression:"form.lat"}})],1)],1),a("Col",{attrs:{span:6}},[a("FormItem",{attrs:{prop:"distance",label:"打卡半径："}},[a("Input",{attrs:{placeholder:"请输入打卡半径（米）"},model:{value:t.form.distance,callback:function(a){t.$set(t.form,"distance",a)},expression:"form.distance"}})],1)],1),a("Col",{attrs:{span:2}},[a("Button",{attrs:{type:"primary",loading:t.submiting},on:{click:t.submit}},[t._v("保存")])],1)],1)],1),a("div",{ref:"map",staticClass:"map"})],1),t.fetching||t.loading?a("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)},n=[],s=i("88bd"),o=i("be5e"),r=i("9484"),l=i("5ca3"),m=i("545e"),c=i("e7c9"),d=i("4d77"),p=i("8c99"),u=i("7736"),f=i("2af9"),h=i("ed08"),g=i("db49"),b={name:"SettingSign",data(){return{fetching:!0,loading:!0,submiting:!1,form:{distance:void 0,lng:void 0,lat:void 0},rules:{distance:[{required:!0,message:"请输入打开半径，单位米"}],lng:[{required:!0,type:"number",message:"请在地图上标记打卡中心位置"}],lat:[{required:!0,type:"number",message:"请在地图上标记打卡中心位置"}]}}},mounted(){this.postInfo.default_community_id&&this.getDetail()},created(){this.script=document.createElement("script"),this.script.type="text/javascript",this.script.src=`//map.qq.com/api/js?v=2.exp&key=${g["e"]}&callback=initMap`,document.head.appendChild(this.script),window.initMap=this.initMap},beforeDestroy(){document.head.removeChild(this.script),this.map=null},methods:{getDetail(){const t={community_id:this.postInfo.default_community_id};this.fetching=!1,h["i"].post("/sign_setting/detail",t).then(t=>{this.form={distance:t.data.distance?t.data.distance:void 0,lng:t.data.lng?t.data.lng:void 0,lat:t.data.lat?t.data.lat:void 0},this.fetching=!1,this.map&&this.form.lng&&this.map.setCenter(new window.qq.maps.LatLng(t.data.lat?t.data.lat:t.data.location.lat,t.data.lng?t.data.lng:t.data.location.lng))}).catch(()=>this.fetching=!1)},initMap(){let t=null;this.map=new window.qq.maps.Map(this.$refs.map,{backgroundColor:"#f7f7f7",zoom:16,mapTypeControlOptions:{mapTypeIds:[]},draggableCursor:"crosshair"});const a=()=>{const a=new window.qq.maps.LatLng(this.form.lat,this.form.lng);t?t.setPosition(a):t=new window.qq.maps.Marker({position:a,map:this.map})};window.qq.maps.event.addListener(this.map,"click",t=>{this.form.lng=t.latLng.getLng(),this.form.lat=t.latLng.getLat(),a()}),this.form.lng&&(this.map.setCenter(new window.qq.maps.LatLng(this.form.lat,this.form.lng)),a()),this.loading=!1},submit(){this.$refs.form.validate(t=>{t&&(this.submiting=!0,h["i"].post("/sign_setting/create",{community_id:this.postInfo.default_community_id,...this.form}).then(()=>{this.submiting=!1,p["a"].success("考勤设置成功")}).catch(()=>this.submiting=!1))})}},computed:{...Object(u["c"])({postInfo:"common/postInfo"}),community_name(){if(!this.postInfo.default_community_id)return"";const t=this.postInfo.community_list.findIndex(t=>t.community_id===this.postInfo.default_community_id);return this.postInfo.community_list[t].name}},watch:{"postInfo.default_community_id"(){this.getDetail()}},components:{Header:f["k"],Spin:d["a"],Input:c["a"],Form:m["a"],FormItem:l["a"],Row:r["a"],Col:o["a"],Button:s["a"]}},w=b,_=(i("2e33"),i("e607")),y=Object(_["a"])(w,e,n,!1,null,null,null);a["default"]=y.exports}}]);