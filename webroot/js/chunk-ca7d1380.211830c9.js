(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ca7d1380"],{"02eb":function(t,e,i){"use strict";var s=i("bb54");e["a"]=s["a"]},"0445":function(t,e,i){},"1b04":function(t,e,i){"use strict";i("4940")},4940:function(t,e,i){},"64f5":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;return e("WaterMark",[e("Header"),e("Card",{attrs:{"dis-hover":"",bordered:!1}},[e("div",{staticClass:"meeting-create"},[e("MeetingSelector",{model:{value:t.meeting,callback:function(e){t.meeting=e},expression:"meeting"}}),e("div",{staticClass:"meeting-participants"},[e("span",[t._v("会议主题：")]),e("Input",{attrs:{type:"textarea",row:3,"show-word-limit":"",maxlength:256,placeholder:"请输入会议主题内容"},model:{value:t.theme,callback:function(e){t.theme=e},expression:"theme"}})],1),e("div",{staticClass:"meeting-participants"},[e("span",[t._v("参会人员：")]),e("Colleague",{attrs:{multiple:""},model:{value:t.participants,callback:function(e){t.participants=e},expression:"participants"}})],1),e("div",{staticClass:"cw-form-actions"},[e("Button",{attrs:{type:"primary",loading:t.submiting},on:{click:t.submit}},[t._v("约定会议室")])],1)],1)])],1)},n=[],o=i("e7c9"),a=i("88bd"),r=i("3e79"),l=i("8c99"),m=(i("ed70"),i("7736")),c=i("2af9"),u=function(){var t=this,e=t._self._c;return e("section",[e("div",{staticClass:"meeting-selector-filter"},[e("span",[t._v("会议室设施：")]),e("CheckboxGroup",{model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}},[e("Checkbox",{attrs:{label:"have_tv"}},[t._v("电视")]),e("Checkbox",{attrs:{label:"have_board"}},[t._v("白板")]),e("Checkbox",{attrs:{label:"have_projector"}},[t._v("投影仪")])],1)],1),e("section",{staticClass:"meeting-selector-wrapper"},[e("div",{staticClass:"meeting-selector"},[e("div",{staticClass:"meeting-selector-header"},[t._m(0),e("div",{staticClass:"meeting-selector-header-inner"},[e("ul",{staticClass:"meeting-selector-week"},t._l(t.weeks,(function(i,s){return e("li",{key:s,class:i.isSame(t.date)?"active":"",on:{click:function(e){return t.selectDate(i)}}},[e("p",[t._v(t._s(t.getWeek(i)))]),e("p",[t._v(t._s(i.format("YYYY年MM月DD日")))])])})),0),e("div",{staticClass:"meeting-selector-hour"},[e("div",{class:["meeting-selector-hour-pre",1===t.step?"disabled":""],on:{click:t.preStep}},[e("Icon",{attrs:{type:"md-arrow-dropleft"}})],1),e("div",{staticClass:"meeting-selector-hour-inner"},[e("ul",{class:"step"+t.step},t._l(24,(function(i){return e("li",{key:i},[t._v(t._s(i-1)+":00")])})),0)]),e("div",{class:["meeting-selector-hour-next",3===t.step?"disabled":""],on:{click:t.nextStep}},[e("Icon",{attrs:{type:"md-arrow-dropright"}})],1)])])]),e("div",{staticClass:"meeting-selector-body"},[t._l(t.rooms,(function(i){return e("div",{key:i.id,staticClass:"meeting-selector-room"},[e("div",{staticClass:"meeting-selector-room-name"},[t._v(" "+t._s(i.name)+" ")]),e("div",{staticClass:"meeting-selector-room-hour"},[e("ul",{class:"step"+t.step},t._l(24,(function(s){return e("li",{key:s},[e("button",{class:["start",t.isActive(i.id,s-1,!1)?"active":"false"],attrs:{disabled:t.isDisabled(i.id,s-1,!1)},on:{click:function(e){return t.selectHour(i.id,s-1,!1)}}}),e("button",{class:["half",t.isActive(i.id,s-1,!0)?"active":"true"],attrs:{disabled:t.isDisabled(i.id,s-1,!0)},on:{click:function(e){return t.selectHour(i.id,s-1,!0)}}})])})),0)])])})),0===t.rooms.length?e("div",{staticClass:"meeting-selector-empty"},[t._v(" 暂无可用的会议室 ")]):t._e()],2)]),t.fetching?e("Spin",{attrs:{size:"large",fix:""}}):t._e()],1),e("div",{staticClass:"meeting-selector-result"},[e("p",[e("span",[t._v("会议室名称：")]),t._v(" "+t._s(t.roomName)+" ")]),e("p",[e("span",[t._v("预定时间：")]),t._v(" "+t._s(t.start_mom?t.start_mom.format("YYYY-MM-DD HH:mm:ss 至 "):"")+" "+t._s(t.end_mom?t.end_mom.format("YYYY-MM-DD HH:mm:ss"):"")+" ")]),e("p",[e("span",[t._v("预订人：")]),t._v(" "+t._s(t.userInfo.real_name)+" ")])])])},d=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"meeting-selector-side"},[e("span",{staticClass:"time"},[t._v("时间")]),e("span",{staticClass:"name"},[t._v("会议室")])])}],h=i("02eb"),p=i("78d8"),_=i("4b1c"),f=i("4d77"),v=i("ed08"),g=i("2f42"),b=i.n(g),C={name:"OaMeetingSelector",props:{value:Object},data(){return{fetching:!0,options:{list:[],using:[]},filter:[],step:1,date:b()().startOf("day"),room_id:null,start_mom:null,end_mom:null}},mounted(){this.postInfo.default_community_id&&this.getOptions()},methods:{getOptions(){this.fetching=!0,v["i"].post("/meeting/option",{community_id:this.postInfo.default_community_id}).then(t=>{this.fetching=!1,this.options=t.data})},getWeek(t){const e=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];return e[t.day()]},preStep(){1!==this.step&&this.step--},nextStep(){3!==this.step&&this.step++},selectDate(t){t.isSame(this.data)||(this.date=t,this.room_id=null,this.start_mom=null,this.end_mom=null,this.trigger())},isDisabled(t,e,i=!1){const s=this.date.clone().hour(e);i&&s.minute(30);const n=s.valueOf(),o=s.clone().add(30,"minute").valueOf();return!this.options.using.every(({meeting_room_id:e,start_time:i,end_time:s})=>e!=t||!(i<=n&&n<s||i<o&&o<=s))},isActive(t,e,i=!1){if(null===this.start_mom||null===this.end_mom||this.room_id!==t)return!1;const s=this.date.clone().hour(e);i&&s.minute(30);const n=s.valueOf(),o=s.clone().add(30,"minute").valueOf(),a=this.start_mom.valueOf(),r=this.end_mom.valueOf();return a<=n&&o<=r},selectHour(t,e,i){const s=this.date.clone().hour(e);i&&s.minute(30);const n=s,o=s.clone().add(30,"minute");if(this.room_id!==t)return this.start_mom=n,this.end_mom=o,this.room_id=t,void this.trigger();n.isBefore(this.start_mom)?this.start_mom=n:this.end_mom=o;const a=this.start_mom.valueOf(),r=this.end_mom.valueOf(),m=!this.options.using.every(({meeting_room_id:e,start_time:i,end_time:s})=>e!=t||!(a<=i&&i<r||a<s&&s<=r));m&&(this.room_id=null,this.start_mom=null,this.end_mom=null,l["a"].warning("会议时间已被占用，请重新选择")),this.trigger()},trigger(){this.$emit("input",{start_time:this.start_mom?this.start_mom.valueOf():null,end_time:this.end_mom?this.end_mom.valueOf():null,id:this.room_id})}},computed:{...Object(m["c"])({postInfo:"common/postInfo",userInfo:"common/userInfo"}),weeks(){const t=[];for(let e=0;e<7;e++){const i=b()().add(e,"day").startOf("day");t.push(i)}return t},rooms(){return 0===this.filter.length?this.options.list:this.options.list.filter(t=>!(this.filter.includes("have_tv")&&!t.have_tv)&&(!(this.filter.includes("have_board")&&!t.have_board)&&!(this.filter.includes("have_projector")&&!t.have_projector)))},roomName(){if(!this.room_id)return"";const t=this.options.list.findIndex(t=>t.id===this.room_id);return this.options.list[t].name}},watch:{"postInfo.default_community_id"(){this.getOptions()},filter:{deep:!0,handler(){this.room_id=null,this.start_mom=null,this.end_mom=null,this.trigger()}}},components:{Spin:f["a"],Icon:_["a"],Checkbox:p["a"],CheckboxGroup:h["a"]}},k=C,y=(i("8b19"),i("e607")),w=Object(y["a"])(k,u,d,!1,null,null,null),O=w.exports,I={name:"OaMeetingCreate",data(){return{submiting:!1,meeting:{start_time:null,end_time:null,id:null},theme:"",participants:[]}},methods:{submit(){if(null===this.meeting.start_time)return l["a"].warning("请选择需要预定的会议室和时间");if(!this.theme)return l["a"].warning("请输入会议主题");if(0===this.participants.length)return l["a"].warning("请选择参会人员");const t={community_id:this.postInfo.default_community_id,...this.meeting,meeting_room_id:this.meeting.id,participants:this.participants.filter(t=>this.userInfo.id!==t),theme:this.theme};if(0===t.participants.length)return l["a"].warning("一个人开什么会呀？");this.submiting=!0,v["i"].post("/meeting/create",t).then(t=>{this.submiting=!1,this.$router.push("/oa/meeting/detail/"+t.data.id)}).catch(()=>this.submiting=!1)}},computed:{...Object(m["c"])({postInfo:"common/postInfo",userInfo:"common/userInfo"})},components:{Header:c["k"],Card:r["a"],WaterMark:c["s"],MeetingSelector:O,Colleague:c["c"],Button:a["a"],Input:o["a"]}},x=I,M=(i("1b04"),Object(y["a"])(x,s,n,!1,null,null,null));e["default"]=M.exports},"8b19":function(t,e,i){"use strict";i("0445")}}]);